
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="iofunc_space_verify()" /><meta name="abstract" content="Do permission checks for the _IO_SPACE message" /><meta name="description" content="Do permission checks for the _IO_SPACE message" /><meta name="indexterms" content="iofunc_space_verify()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-i.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.resmgr/topic/about.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.getting_started/topic/s1_resmgr.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fcntl.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/ftruncate.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/iofunc_ocb_t.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/iofunc_open.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/iofunc_write_default.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/iofunc_write_verify.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/l/ltrunc.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/p/posix_fallocate.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/r/resmgr_context_t.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="iofunc_space_verify" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>iofunc_space_verify()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="iofunc_space_verify">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-i.html" title="I">I</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-i.html" title="I"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">I</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">iofunc_space_verify()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>


<div class="body refbody"><p class="shortdesc"><em class="ph i">Do permission checks for the _IO_SPACE message</em></p>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>

<pre class="pre codeblock">
#include &lt;sys/iofunc.h&gt;

int iofunc_space_verify( resmgr_context_t *<var class="keyword varname">ctp</var>, 
                         io_space_t *<var class="keyword varname">msg</var>, 
                         iofunc_ocb_t *<var class="keyword varname">ocb</var>, 
                         int *<var class="keyword varname">nonblock</var> ); 
</pre>

</div>



<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">ctp</var></dt>

<dd class="dd">A pointer to a
  <a class="xref" href="../r/resmgr_context_t.html" title="Context information that's passed between resource-manager functions"><span class="keyword dtype">resmgr_context_t</span></a>
  structure that the resource-manager library uses to pass context information
  between functions.
</dd>




<dt class="dt dlterm"><var class="keyword varname">msg</var></dt>

<dd class="dd">A pointer to the
  <a class="xref" href="#iofunc_space_verify__io_space_t"><span class="keyword dtype">io_space_t</span></a>
  structure that contains
  the message that the resource manager received; see below.
</dd>




<dt class="dt dlterm"><var class="keyword varname">ocb</var></dt>

<dd class="dd">A pointer to the
  <a class="xref" href="iofunc_ocb_t.html" title="Open Control Block structure"><span class="keyword dtype">iofunc_ocb_t</span></a>
  structure for the Open Control Block that was created when the
  client opened the resource.
</dd>




<dt class="dt dlterm"><var class="keyword varname">nonblock</var></dt>

<dd class="dd"><span class="keyword const">NULL</span>, or a pointer to a location where the function can
  store a value that indicates whether or not the device is nonblocking:

  <ul class="ul">
  <li class="li">Zero â the client doesn't want to be blocked (i.e.,
    <span class="keyword const">O_NONBLOCK</span> was set).
    
  </li>


  <li class="li">Nonzero â the client wants to be blocked.</li>

  </ul>

</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Library:</h2>


<p class="p"><span class="ph filepath">libc</span></p>

<p class="p">Use the <span class="keyword option">-l c</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library.
This library is usually included automatically.</p>

</div>



<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p">




The <span class="keyword apiname">iofunc_space_verify()</span> function checks that the client 
<span class="keyword const">_IO_SPACE</span> message is well-formed and the operation
should be allowed to succeed. This function may update fields for proper behavior. Optionally,
it further reports if the operation may be treated as nonblocking.
</p>


<p class="p">
All space handlers should start with a call to <span class="keyword apiname">iofunc_space_verify()</span> and 
proceed only if it returns EOK.
</p>


<div class="p">This function checks at least that:
<ul class="ul">
  <li class="li">the original open included write access</li>

  <li class="li">this operation is not attempting to write to a directory</li>

  <li class="li">the file is not on a read-only filesystem</li>

  <li class="li">on regular files on 32-bit filesystems, if <var class="keyword varname">whence</var> equals 
    <span class="keyword const">SEEK_SET</span>, <var class="keyword varname">start</var> + <var class="keyword varname">len</var> does not exceed 
    <span class="keyword const">INT32_MAX</span></li>

</ul>

</div>


<div class="p">This function updates the following:
<ul class="ul">
  <li class="li">If a non-NULL <var class="keyword varname">nonblock</var> pointer is passed in, the value pointed to will be
    set to 0 if the operation may be allowed to block, and to <span class="keyword const">O_NONBLOCK</span> if the
    operation should not be allowed to block.</li>

  <li class="li">If this is a space operation on an executable file with any setid bits set (e.g., the setuid
    bit), then all setid bits will be zeroed (unset) in the attribute structure, unless the space
    operation is from a root (i.e., an euid of 0) process</li>

</ul>

</div>


<p class="p" id="iofunc_space_verify__io_space_t"><strong class="ph b"><span class="keyword dtype">io_space_t</span> structure</strong></p>


<p class="p">

The <span class="keyword dtype">io_space_t</span> structure holds the <span class="keyword const">_IO_SPACE</span>
message received by the resource manager:
</p>


<pre class="pre codeblock">
struct _io_space {
    uint16_t                    type;
    uint16_t                    combine_len;
    uint16_t                    subtype;
    short                       whence;
    uint64_t                    start;
    uint64_t                    len;
};

typedef union {
    struct _io_space            i;
    uint64_t                    o;
} io_space_t;
</pre>


<p class="p">
The I/O message structures are unions of an input message (coming to the
resource manager) and an output or reply message (going back to the client).
</p>


<p class="p">
The <var class="keyword varname">i</var> member is a structure of type <span class="keyword dtype">_io_space</span> that
contains the following members:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">type</var></dt>

<dd class="dd"><span class="keyword const">_IO_SPACE</span>.</dd>




<dt class="dt dlterm"><var class="keyword varname">combine_len</var></dt>

<dd class="dd">If the message is a combine message, <span class="keyword const">_IO_COMBINE_FLAG</span>
  is set in this member.
  For more information, see
  <a class="xref" href="../../../com.qnx.doc.neutrino.resmgr/topic/combine.html">Combine Messages</a>
  chapter of <cite class="cite">Writing a Resource Manager</cite>.
  
</dd>




<dt class="dt dlterm"><var class="keyword varname">subtype</var></dt>

<dd class="dd"><span class="keyword const">F_ALLOCSP</span>, <span class="keyword const">F_FREESP</span>, or <span class="keyword const">F_GROWSP</span>.
  
  
  
</dd>




<dt class="dt dlterm"><var class="keyword varname">whence</var></dt>

<dd class="dd">The position in the file.
  The possible values (defined in <span class="ph filepath">&lt;unistd.h&gt;</span>) are:

  <dl class="dl">
  
  <dt class="dt dlterm"><span class="keyword const">SEEK_CUR</span></dt>

  <dd class="dd">The new file position is computed relative to the current file
    position. The value of <var class="keyword varname">start</var> may be positive, negative or zero.
    
  </dd>

  

  
  <dt class="dt dlterm"><span class="keyword const">SEEK_END</span></dt>

  <dd class="dd">The new file position is computed relative to the end of the file.
    
  </dd>

  

  
  <dt class="dt dlterm"><span class="keyword const">SEEK_SET</span></dt>

  <dd class="dd">The new file position is computed relative to the start of the file.
     The value of <var class="keyword varname">start</var> must not be negative.
     
  </dd>

  

  </dl>

</dd>




<dt class="dt dlterm"><var class="keyword varname">start</var></dt>

<dd class="dd">The relative offset from the file position determined by the
  <var class="keyword varname">whence</var> member.
</dd>




<dt class="dt dlterm"><var class="keyword varname">len</var></dt>

<dd class="dd">The relative size by which to increase the file.
  A value of zero means to end of file.
</dd>



</dl>


<p class="p">
The <var class="keyword varname">o</var> member is the file size.
</p>


<p class="p">
The <span class="keyword const">_IO_SPACE</span> message is generated by functions that set a file size or grow a file,
such as <span class="keyword apiname">ftruncate()</span> or <span class="keyword apiname">posix_fallocate()</span>.
</p>


</div>



<div class="section"><h2 class="title sectiontitle">Returns:</h2>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">The client is allowed to perform this space operation.</dd>




<dt class="dt dlterm"><span class="keyword const">EBADF</span></dt>

<dd class="dd">The resource wasn't opened for writing.</dd>




<dt class="dt dlterm"><span class="keyword const">EFBIG</span></dt>

<dd class="dd">The file is a regular file, and the length is greater than the maximum offset associated with the file.</dd>




<dt class="dt dlterm"><span class="keyword const">EISDIR</span></dt>

<dd class="dd">The resource is a directory.</dd>




<dt class="dt dlterm"><span class="keyword const">EROFS</span></dt>

<dd class="dd">The file resides on a read-only filesystem (e.g., it was opened with <span class="keyword const">O_RDWR</span>
  and later the filesystem was remounted as read-only).
</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Classification:</h2>

<p class="p"><a class="xref" href="../summary.html#summary__CLASSIFICATION">QNX Neutrino</a></p>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr><th class="entry" valign="top" id="d2057349e530">Safety:</th>
<th class="entry" valign="top" id="d2057349e532">Â </th>
</tr>

</thead>

<tbody class="tbody">
<tr><td class="entry" valign="top" headers="d2057349e530 d2057349e532 ">Cancellation point</td>
<td class="entry" valign="top" headers="d2057349e530 d2057349e532 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d2057349e530 d2057349e532 ">Interrupt handler</td>
<td class="entry" valign="top" headers="d2057349e530 d2057349e532 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d2057349e530 d2057349e532 ">Signal handler</td>
<td class="entry" valign="top" headers="d2057349e530 d2057349e532 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d2057349e530 d2057349e532 ">Thread</td>
<td class="entry" valign="top" headers="d2057349e530 d2057349e532 ">Yes</td>
</tr>

</tbody>

</table>
</div>

</div>


</div>





<div class="related-links"><div class="relinfo relconcepts"><strong>Related concepts</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.resmgr/topic/about.html" title="Writing a Resource Manager">Writing a Resource Manager</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.getting_started/topic/s1_resmgr.html" title="Resource Managers (Getting Started with QNX Neutrino)">Resource Managers (Getting Started with <span class="keyword">QNX Neutrino</span>)</a></div>
</div>
<div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fcntl.html" title="Provide control over an open file">fcntl()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/ftruncate.html" title="Truncate a file">ftruncate(), ftruncate64()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/iofunc_ocb_t.html" title="Open Control Block structure">iofunc_ocb_t</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/iofunc_open.html" title="Verify a client's ability to open or to create a resource">iofunc_open()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/iofunc_write_default.html" title="Default handler for _IO_WRITE messages">iofunc_write_default()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/iofunc_write_verify.html" title="Verify a client's write access to a resource">iofunc_write_verify()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/l/ltrunc.html" title="Truncate a file at a given position">ltrunc()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/p/posix_fallocate.html" title="Allocate space for a file on the filesystem">posix_fallocate(), posix_fallocate64()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/r/resmgr_context_t.html" title="Context information that's passed between resource-manager functions">resmgr_context_t</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-i.html" title="I"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">I</span></a></span>  </div>
</body>
</html>