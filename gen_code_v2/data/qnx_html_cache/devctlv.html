
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="devctl(),devctlv()" /><meta name="abstract" content="Control a device" /><meta name="description" content="Control a device" /><meta name="indexterms" content="devctl(), devctlv()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-d.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.prog/topic/process_proc_filesystem.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/c/close.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/g/getiovbase.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/g/getiovlen.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/ioctl.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/o/open.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/p/posix_devctl.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/r/read.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/s/setiov.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/w/write.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.devctl/topic/about.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="devctl" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>devctl(),devctlv()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="devctl">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-d.html" title="D">D</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-d.html" title="D"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">D</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">devctl()</span>,<span class="keyword apiname">devctlv()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>




<div class="body refbody"><p class="shortdesc"><em class="ph i">Control a device</em></p>


<div class="section">
<p class="p">



</p>

</div>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>

<pre class="pre codeblock">
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
#include &lt;devctl.h&gt;

int devctl( int <var class="keyword varname">filedes</var>,
            int <var class="keyword varname">dcmd</var>,
            void * <var class="keyword varname">dev_data_ptr</var>,
            size_t <var class="keyword varname">n_bytes</var>,
            int * <var class="keyword varname">dev_info_ptr</var> );

int devctlv( int <var class="keyword varname">filedes</var>,
             int <var class="keyword varname">dcmd</var>,
             int <var class="keyword varname">sparts</var>,
             int <var class="keyword varname">rparts</var>,
             const iov_t *<var class="keyword varname">sv</var>,
             const iov_t *<var class="keyword varname">rv</var>,
             int *<var class="keyword varname">dev_info_ptr</var>);
</pre>


<div class="note note"><span class="notetitle">Note:</span> 

We've defined <span class="keyword apiname">posix_devctl()</span> to be an alias for <span class="keyword apiname">devctl()</span>.
</div>

</div>



<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">filedes</var></dt>

<dd class="dd">A file descriptor that you obtained by opening the device.</dd>




<dt class="dt dlterm"><var class="keyword varname">dcmd</var></dt>

<dd class="dd">A device-specific command for the process managing the open device.
  The set of valid device-control commands, the associated data interpretation,
  the returned <var class="keyword varname">dev_info_ptr</var> values, 
  and the effect of the command on the device all depend on the device driver.

  
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
  <thead class="thead" align="left">
  <tr>
    <th class="entry" valign="top" id="d1337331e131">For:</th>

    <th class="entry" valign="top" id="d1337331e134">See:</th>

  </tr>

  </thead>


  <tbody class="tbody">

  <tr>
    <td class="entry" valign="top" headers="d1337331e131 d1337331e134 ">General information</td>

    <td class="entry" valign="top" headers="d1337331e131 d1337331e134 "><span class="q">&#147;<a class="xref" href="#devctl__Commands">Device-control commands</a>,&#148;</span> below</td>

  </tr>


  <tr>
    <td class="entry" valign="top" headers="d1337331e131 d1337331e134 ">Commands for manipulating processes</td>

    <td class="entry" valign="top" headers="d1337331e131 d1337331e134 "><span class="q">&#147;<a class="xref" href="../../../com.qnx.doc.neutrino.prog/topic/process_proc_filesystem.html">Controlling processes via the <span class="ph filepath">/proc</span> filesystem</a>&#148;</span>
           in the Processes chapter of the <span class="keyword">QNX Neutrino</span> <cite class="cite">Programmer's Guide</cite>
    </td>

  </tr>


  <tr>
    <td class="entry" valign="top" headers="d1337331e131 d1337331e134 ">Specific commands</td>

    <td class="entry" valign="top" headers="d1337331e131 d1337331e134 "><a class="xref" href="../../../com.qnx.doc.neutrino.devctl/topic/about.html"><em class="ph i">Devctl and Ioctl Commands</em></a>
      and the <span class="ph filepath">&lt;sys/dcmd_*.h&gt;</span> header files</td>

  </tr>


  </tbody>

  </table>
</div>

</dd>




<dt class="dt dlterm"><var class="keyword varname">dev_data_ptr</var></dt>

<dd class="dd">(<span class="keyword apiname">devctl()</span> only)
  Depending on the command, this argument is one of:

  <ul class="ul">
  <li class="li">a pointer to a buffer containing data to be passed to the driver</li>

  <li class="li">a receiving area for data coming from the driver</li>

  <li class="li">both of the above </li>

  <li class="li"><span class="keyword const">NULL</span></li>

  </ul>

</dd>




<dt class="dt dlterm"><var class="keyword varname">n_bytes</var></dt>

<dd class="dd">(<span class="keyword apiname">devctl()</span> only)
  The size of the data to be sent to the driver,
  or the maximum size of the data to be received from the driver.
  If the size is greater than <span class="keyword const">SSIZE_MAX</span><tt class="ph tt"> - sizeof(io_devctl_t)</tt>
  (see <span class="ph filepath">&lt;limits.h&gt;</span>), the function fails and sets <var class="keyword varname">errno</var> 
  to <span class="keyword const">EOVERFLOW</span>.
</dd>




<dt class="dt dlterm"><var class="keyword varname">sparts</var></dt>

<dd class="dd">(<span class="keyword apiname">devctlv()</span> only)
  The number of elements in the <var class="keyword varname">sv</var> array.
  The maximum number of entries is <span class="keyword const">UIO_MAXIOV</span>,
  and the sum of <var class="keyword varname">sparts</var> and <var class="keyword varname">rparts</var> must not exceed 524288, 
  or the function fails and sets <var class="keyword varname">errno</var> to <span class="keyword const">EOVERFLOW</span>.
</dd>




<dt class="dt dlterm"><var class="keyword varname">rparts</var></dt>

<dd class="dd">(<span class="keyword apiname">devctlv()</span> only)
  The number of elements in the <var class="keyword varname">rv</var> array.
  The maximum number of entries is <span class="keyword const">UIO_MAXIOV</span>,
  and the sum of <var class="keyword varname">sparts</var> and <var class="keyword varname">rparts</var> must not exceed 524288, 
  or the function fails and sets <var class="keyword varname">errno</var> to <span class="keyword const">EOVERFLOW</span>.
</dd>




<dt class="dt dlterm"><var class="keyword varname">sv</var></dt>

<dd class="dd">(<span class="keyword apiname">devctlv()</span> only) An array of buffers that hold the data
  to send to the driver. The combined length of these buffers and those in 
  <var class="keyword varname">rv</var> must not exceed <span class="keyword const">SSIZE_MAX</span>, or the function fails 
  and sets <var class="keyword varname">errno</var> to <span class="keyword const">EOVERFLOW</span>.
</dd>




<dt class="dt dlterm"><var class="keyword varname">rv</var></dt>

<dd class="dd">(<span class="keyword apiname">devctlv()</span> only) An array of buffers in which the driver
  can store data to return to the caller. The combined length of these buffers and those in 
  <var class="keyword varname">sv</var> must not exceed <span class="keyword const">SSIZE_MAX</span>, or the function fails 
  and sets <var class="keyword varname">errno</var> to <span class="keyword const">EOVERFLOW</span>.
</dd>




<dt class="dt dlterm"><var class="keyword varname">dev_info_ptr</var></dt>

  <dd class="dd"><span class="keyword const">NULL</span>, or a pointer to a location that the device can use to return additional
            status information on success, that is, the location is only updated when the function
            returns EOK. The data returned via <var class="keyword varname">dev_info_ptr</var> depends on the device driver.</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Library:</h2>


<p class="p"><span class="ph filepath">libc</span></p>


<p class="p">
Use the <span class="keyword option">-l c</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library.
This library is usually included automatically.
</p>

</div>



<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p">
The <span class="keyword apiname">devctl()</span> function sends the device-specific command <var class="keyword varname">dcmd</var>
to the process managing the device opened as <var class="keyword varname">filedes</var>.
For example, you can send commands to specify properties for devices such as keyboards,
sound cards or serial ports.
</p>


<p class="p">
The <span class="keyword apiname">devctlv()</span> function is similar to <span class="keyword apiname">devctl()</span>, but
uses I/O vectors for passing data to and from the driver.
</p>


<h2 class="sectiontitle" id="devctl__Commands">Device-control commands</h2>

<div class="p">
Use these macros to set up the device-control commands:

<dl class="dl">

<dt class="dt dlterm"><span class="keyword apiname">__DIOF</span>(<var class="keyword varname">class</var>, <var class="keyword varname">cmd</var>, <var class="keyword varname">data</var>)</dt>

<dd class="dd">Get information from the device.
  
</dd>




<dt class="dt dlterm"><span class="keyword apiname">__DION</span>(<var class="keyword varname">class</var>, <var class="keyword varname">cmd</var>)</dt>

<dd class="dd">Send a command with no associated data.
  
</dd>




<dt class="dt dlterm"><span class="keyword apiname">__DIOT</span>(<var class="keyword varname">class</var>, <var class="keyword varname">cmd</var>, <var class="keyword varname">data</var>)</dt>

<dd class="dd">Pass information to the device.
  
</dd>




<dt class="dt dlterm"><span class="keyword apiname">__DIOTF</span>(<var class="keyword varname">class</var>, <var class="keyword varname">cmd</var>, <var class="keyword varname">data</var>)</dt>

<dd class="dd">Pass some information to the device, and get some from it.
  
</dd>



</dl>

</div>


<div class="p">
The arguments to these macros are:

<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">class</var></dt>

<dd class="dd">The major category for the command.
  The device-control commands are divided into the following classes to make organization easier:

  <ul class="ul">
  <li class="li"><span class="keyword const">_DCMD_ALL</span> â Common (all I/O servers).
    
  </li>


  <li class="li"><span class="keyword const">_DCMD_CAM</span> â Low-level (Common Access Method) devices, such as disks or CD-ROMs.
    
  </li>


  <li class="li"><span class="keyword const">_DCMD_CHR</span> â Character devices.
    
  </li>


  <li class="li"><span class="keyword const">_DCMD_FSYS</span>, <span class="keyword const">_DCMD_BLK</span> â Filesystem/block I/O managers.
    
    
  </li>


  <li class="li"><span class="keyword const">_DCMD_INPUT</span> â Input devices.
    
  </li>


  <li class="li"><span class="keyword const">_DCMD_IP</span> â Internet Protocol.
    
  </li>


  <li class="li"><span class="keyword const">_DCMD_MEM</span> â Memory card.
    
  </li>


  <li class="li"><span class="keyword const">_DCMD_MISC</span> â Miscellaneous commands.
    
  </li>


  <li class="li"><span class="keyword const">_DCMD_MIXER</span> â Mixer (Audio).
    
  </li>


  <li class="li"><span class="keyword const">_DCMD_NET</span> â Network devices.
    
  </li>


  

  <li class="li"><span class="keyword const">_DCMD_PROC</span> â Process manager.
    
  </li>


  </ul>

</dd>




<dt class="dt dlterm"><var class="keyword varname">cmd</var></dt>

<dd class="dd">The specific command in the class.</dd>




<dt class="dt dlterm"><var class="keyword varname">data</var></dt>

<dd class="dd">The type of data to pass to and/or from the device.
  The <var class="keyword varname">dev_data_ptr</var> argument to <span class="keyword apiname">devctl()</span> must be
  a pointer to this type of data, and <var class="keyword varname">n_bytes</var> is usually the
  size of this type of data.

  <div class="note note"><span class="notetitle">Note:</span> 
  The size of the structure that's passed as the last
  field to the <span class="keyword apiname">__DIO*</span> macros <strong class="ph b">must</strong> be less than
  2^14Â ==Â 16 KB.
  Anything larger than this interferes with the upper two directional bits.
  </div>

</dd>



</dl>

</div>


<div class="p">

Resource managers can use the following macros, which are defined in 
<span class="ph filepath">&lt;devctl.h&gt;</span>,
when handling commands:

<dl class="dl">

<dt class="dt dlterm"><span class="keyword apiname">get_device_command</span>(<var class="keyword varname">cmd</var>)</dt>

<dd class="dd">Extract the class and the specific device command from <var class="keyword varname">cmd</var>
  (i.e., strip off the data type and the direction).
  
</dd>




<dt class="dt dlterm"><span class="keyword apiname">get_device_direction</span>(<var class="keyword varname">cmd</var>)</dt>

<dd class="dd">Get the direction of the command (<span class="keyword const">DEVDIR_TO</span>,
  <span class="keyword const">DEVDIR_FROM</span>, <span class="keyword const">DEVDIR_TOFROM</span>, or <span class="keyword const">DEVDIR_NONE</span>).
  
  
  
  
  
</dd>





</dl>

</div>


<div class="note note"><span class="notetitle">Note:</span> 






If you're writing a resource manager, note that the
<a class="xref" href="../i/iofunc_devctl_default.html" title="Default handler for _IO_DEVCTL messages"><span class="keyword apiname">iofunc_devctl_default()</span></a>
function handles the <span class="keyword const">DCMD_ALL_GETFLAGS</span> and
<span class="keyword const">DCMD_ALL_SETFLAGS</span> commands; your resource manager will
need to handle all other <span class="keyword cmdname">devctl</span> commands that apply to it.
</div>


</div>



<div class="section"><h2 class="title sectiontitle">Returns:</h2>


<dl class="dl">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EAGAIN</span></dt>

<dd class="dd">Resource is temporarily unavailable; try again.</dd>




<dt class="dt dlterm"><span class="keyword const">EBADF</span></dt>

<dd class="dd">Invalid open file descriptor, <var class="keyword varname">filedes</var>.</dd>




<dt class="dt dlterm"><span class="keyword const">EINTR</span></dt>

<dd class="dd">The <span class="keyword apiname">devctl()</span> function was interrupted by a signal.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The device driver detected an error in <var class="keyword varname">dev_data_ptr</var> or <var class="keyword varname">n_bytes</var>.</dd>




<dt class="dt dlterm"><span class="keyword const">EIO</span></dt>

<dd class="dd">The <span class="keyword apiname">devctl()</span> function couldn't complete because of a hardware error.</dd>




<dt class="dt dlterm"><span class="keyword const">EFAULT</span></dt>

<dd class="dd">A fault occurred trying to access the buffers provided.</dd>


  

<dt class="dt dlterm"><span class="keyword const">ENOTTY</span></dt>

<dd class="dd">The device doesn't support the <var class="keyword varname">dcmd</var> command.</dd>




<dt class="dt dlterm"><span class="keyword const">ENXIO</span></dt>

<dd class="dd">No such device or address.
  For example, there's no media available to be loaded in the device
  represented by the file descriptor.
</dd>




<dt class="dt dlterm"><span class="keyword const">EOVERFLOW</span></dt>

<dd class="dd">One of the following occurred: 
  <ul class="ul">
   <li class="li">An attempt was made to send or receive an amount of data 
      that when added to the size of the device control structure exceeds the allowable limit.</li>

    <li class="li">(<span class="keyword apiname">devctlv()</span> only) The sum of the IOV lengths for the send and receive 
      buffers combined exceeds <span class="keyword const">SSIZE_MAX</span>, or the number of parts for the send and 
      receive buffers combined exceeds 524288. </li>

  </ul>

</dd>




<dt class="dt dlterm"><span class="keyword const">EPERM</span></dt>

<dd class="dd">The process doesn't have sufficient permission to carry out the requested command.</dd>



</dl>


<p class="p">
Specific <span class="keyword apiname">devctl()</span> commands might return other error codes; see
<a class="xref" href="../../../com.qnx.doc.neutrino.devctl/topic/about.html"><em class="ph i">Devctl and Ioctl Commands</em></a>.
</p>


</div>



<div class="section"><h2 class="title sectiontitle">Examples:</h2>


<h2 class="sectiontitle">Example 1: Setting RTS on a serial port</h2>

<div class="p">
Here's a quick example of setting and unsetting RTS (Request to Send) on a serial port:

<pre class="pre codeblock">
/* For "devctl()" */
#include &lt;devctl.h&gt;
#include &lt;sys/dcmd_chr.h&gt;

/* For "open()" */
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;

/* For "strerror()" */
#include &lt;string.h&gt;

/* For Errors */
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

int check_RTS(int fd);

int main(void)
{
    int data = 0, fd, error;

    if((fd = open ("/dev/ser2", O_RDONLY)) == -1)
    {
     fprintf(stderr,
        "Error with open() on /dev/ser2.  Make sure it exists.\n");
     perror (NULL);
     exit(EXIT_FAILURE);
    }

    check_RTS(fd);

    /* Let's turn ON RTS now. */
    data = _CTL_RTS_CHG | _CTL_RTS;

    if (error = devctl (fd, DCMD_CHR_SERCTL, &amp;data,
                   sizeof(data), NULL))
    {
    fprintf(stderr, "Error setting RTS: %s\n",
        strerror ( error ));
        exit(EXIT_FAILURE);
    }
    /* RTS should now be ON. */

    check_RTS(fd);

    sleep (2);


    /* Now let's turn RTS OFF. */
    data = _CTL_RTS_CHG | 0;

    if (error = devctl (fd, DCMD_CHR_SERCTL, &amp;data,
                   sizeof(data), NULL))
    {
        fprintf(stderr, "Error setting RTS: %s\n",
            strerror ( error ));
        exit(EXIT_FAILURE);
    }
    /* RTS should now be OFF. */

    check_RTS(fd);

    close(fd);

    return (1);
}


int check_RTS(int fd)
{
    int data = 0, error;

    /*
     Let's see if RTS is set by using devctl() to get
     line status information.
    */
    if (error = devctl (fd, DCMD_CHR_LINESTATUS, &amp;data,
                        sizeof(data), NULL))
    {
       fprintf(stderr, "Error getting RTS: %s\n",
           strerror ( error ));
       exit(EXIT_FAILURE);
    }

    if (data &amp; _LINESTATUS_SER_RTS)
        printf("RTS is SET!\n");
    else
        printf("RTS is NOT set\n");

    return(1);
}
</pre>

</div>


<p class="p">
The two main areas of interest are the setting of <var class="keyword varname">data</var> and the <span class="keyword apiname">devctl()</span> call.
The data variable is used for both sending and receiving data. 
</p>


<div class="p">
When setting RTS, <var class="keyword varname">data</var> is assigned a value that's sent to the device via <span class="keyword apiname">devctl()</span>.


<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">

<thead class="thead" align="left">
<tr>
  <th class="entry" valign="top" id="d1337331e1046">If <var class="keyword varname">data</var> equals:</th>

  <th class="entry" valign="top" id="d1337331e1052">RTS is turned:</th>

</tr>

</thead>


<tbody class="tbody">

<tr>
  <td class="entry" valign="top" headers="d1337331e1046 d1337331e1052 "><span class="keyword const">_CTL_RTS_CHG</span> | <span class="keyword const">_CTL_RTS</span></td>

  <td class="entry" valign="top" headers="d1337331e1046 d1337331e1052 ">ON</td>

</tr>


<tr>
  <td class="entry" valign="top" headers="d1337331e1046 d1337331e1052 "><span class="keyword const">_CTL_RTS_CHG</span></td>

  <td class="entry" valign="top" headers="d1337331e1046 d1337331e1052 ">OFF</td>

</tr>


</tbody>

</table>
</div>

</div>


<p class="p">
When checking to see if RTS is set, we call <span class="keyword apiname">devctl()</span> with <var class="keyword varname">dcmd</var> set to
the <span class="keyword const">DCMD_CHR_LINESTATUS</span> macro and <var class="keyword varname">data</var> containing any value (zero is clean).
The <span class="keyword apiname">devctl()</span> function returns with <var class="keyword varname">data</var> containing the Line Status value.
This then can be used to determine what lines are set on that device.
In our example, we check against <span class="keyword const">_LINESTATUS_SER_RTS</span>.
</p>


<p class="p">
To find out what values to use with different <span class="keyword const">DCMD_*</span> commands, look in the
appropriate <span class="ph filepath">&lt;sys/dcmd_*.h&gt;</span> header file.
For example, you'll find macros for the following values under <span class="keyword const">DCMD_CHR_LINESTATUS</span>
in <span class="ph filepath">&lt;sys/dcmd_chr.h&gt;</span>:
</p>


<ul class="ul">
<li class="li">Serial Port (DTR, RTS, CTS, DSR, RI, CD)</li>


<li class="li">Keyboard (Scroll/Caps/Num Lock, Shift, CTRL, ALT)</li>


<li class="li">Parallel Port (No Error, Selected, Paper Out, No Tack, Not Busy)</li>


</ul>


<p class="p">
The value that's in the header is a bitwise AND with the value in <var class="keyword varname">data</var>
to see if the value is high for that line. 
</p>


<h2 class="sectiontitle">Example 2: Cycling through Caps Lock, Num Lock, and Scroll Lock</h2>

<p class="p">
In the following example, we open the device <span class="ph filepath">/dev/kbd</span> and we start applying
changes to the <span class="keyword key">Caps Lock</span>, <span class="keyword key">Scroll Lock</span>, and <span class="keyword key">Num Lock</span> properties. 
</p>


<div class="p">
The key lines in this example are the same as in the last example; they focus around the data variable.
This value is just a simple integer value that's passed into the <span class="keyword apiname">devctl()</span> function. 
The data variable is assigned its values by simply performing a bitwise OR to the predefined 
values in the <span class="ph filepath">&lt;/usr/include/sys/dcmd_chr.h&gt;</span> header. 
Note the values used in the bitwise OR: 

<ul class="ul">
<li class="li"><span class="keyword const">_CONCTL_NUM_CHG</span> (Console Control Num Lock Change) ORed together with 
  <span class="keyword const">_CONCTL_NUM</span> (Console Control Num Lock) turns on <span class="keyword key">Num Lock</span>. 
</li>


<li class="li"><span class="keyword const">_CONCTL_NUM_CHG</span> on its own turns off <span class="keyword key">Num Lock</span>.</li>


</ul>

</div>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr>
  <th class="entry" valign="top" id="d1337331e1203">If <var class="keyword varname">data</var> equals:</th>

  <th class="entry" valign="top" id="d1337331e1209"><span class="keyword key">Num Lock</span> is turned:</th>

</tr>

</thead>


<tbody class="tbody">
<tr>
  <td class="entry" valign="top" headers="d1337331e1203 d1337331e1209 "><span class="keyword const">_CONCTL_NUM_CHG</span> | <span class="keyword const">_CONCTL_NUM</span></td>

  <td class="entry" valign="top" headers="d1337331e1203 d1337331e1209 ">ON</td>

</tr>


<tr>
  <td class="entry" valign="top" headers="d1337331e1203 d1337331e1209 "><span class="keyword const">_CONCTL_NUM_CHG</span></td>

  <td class="entry" valign="top" headers="d1337331e1203 d1337331e1209 ">OFF</td>

</tr>


</tbody>

</table>
</div>


<div class="p">
This also applies for the other either/or values in the <span class="ph filepath">&lt;dcmd_chr.h&gt;</span> header.

<pre class="pre codeblock">
/* For "devctl()" */
#include &lt;devctl.h&gt;
#include &lt;sys/dcmd_chr.h&gt;

/* For "open()" */
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;

/* For "strerror()" */
#include &lt;string.h&gt;

/* For Errors */
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;


int main(void)
{
    int data, fd, toggle = 1, error;

    /* Open the device we wish to manipulate. */
    if((fd = open ("/dev/kbd", O_RDONLY)) == -1)
    {
     fprintf(stderr,
        "Error with open() on /dev/kbd.  Make sure it exists.\n");
     perror (NULL);
     exit(EXIT_FAILURE);
    }

    while(1)
    {
    switch(toggle)
    {
        case 1:
        {
          /*
           Turn on Num Lock and make sure that 
           Caps and Scroll lock are turned off.
          */
          data = (_CONCTL_NUM_CHG | _CONCTL_NUM) | _CONCTL_CAPS_CHG |
                 _CONCTL_SCROLL_CHG;
          break;
        }
        case 2:
        {
          /*
           Turn off Num Lock and now turn on Caps Lock 
           (Scroll lock is already off).
          */
          data = _CONCTL_NUM_CHG | (_CONCTL_CAPS_CHG | _CONCTL_CAPS);
          break;
        }
        case 3:
        {
          /*
           Turn off Caps lock and turn on Scroll lock 
           (Num lock is already off).
          */
          data = _CONCTL_CAPS_CHG | (_CONCTL_SCROLL_CHG | _CONCTL_SCROLL);
          toggle = 0;
          break;
        }
    }

    /* Explanation below. */
    if (error = devctl (fd, DCMD_CHR_SERCTL, &amp;data,
                        sizeof(data), NULL))
    {
        fprintf(stderr, "Error setting KBD: %s\n",
            strerror ( error ));
        exit(EXIT_FAILURE);
    }

    sleep(1);
    toggle++;
    }

    return (1);
}
</pre>

</div>


<div class="p">
Here's a quick explanation of the above <span class="keyword apiname">devctl()</span> call:

<pre class="pre codeblock">
devctl (fd, DCMD_CHR_SERCTL, &amp;data, sizeof(data), NULL)
</pre>

</div>


<p class="p">
The first parameter, <var class="keyword varname">fd</var>, is the file descriptor of the device that's being changed. 
The second parameter is the device class that's being changed. 
In this case, it's a character device <samp class="ph codeph">DCMD_CHR</samp>,
with a <span class="q">&#147;subclass&#148;</span> of <samp class="ph codeph">_SERCTL</samp>.
The third parameter is the data variable; this is the ORed value.
</p>


<h2 class="sectiontitle">Example 3: Duration example</h2>

<div class="p">
In this code, <span class="keyword apiname">tcdropline()</span>, which is used to disconnect a communications line,
uses <span class="keyword apiname">devctl()</span> (this is the actual source code, 
<a class="xref" href="../t/tcdropline.html" title="Disconnect a communications line"><span class="keyword apiname">tcdropline()</span></a>
is a standard library function):

<pre class="pre codeblock">
#include &lt;termios.h&gt;
#include &lt;devctl.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/dcmd_chr.h&gt;

int tcdropline(int fd, int duration) {
    int error; 

    duration = ((duration ? duration : 300) &lt;&lt; 16) | _SERCTL_DTR_CHG | 0;

    if ((error = devctl(fd, DCMD_CHR_SERCTL, &amp;duration, 
                        sizeof duration, 0)) != EOK) {
       if (error == ENOSYS) {
          errno = ENOTTY;
       }
       return -1;
    }
    return 0;
}
</pre>

</div>


</div>



<div class="section"><h2 class="title sectiontitle">Classification:</h2>

<p class="p"><a class="xref" href="../summary.html#summary__CLASSIFICATION">QNX Neutrino</a></p>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr><th class="entry" valign="top" id="d1337331e1320">Safety:</th>
<th class="entry" valign="top" id="d1337331e1322">Â </th>
</tr>

</thead>

<tbody class="tbody">
<tr><td class="entry" valign="top" headers="d1337331e1320 d1337331e1322 ">Cancellation point</td>
<td class="entry" valign="top" headers="d1337331e1320 d1337331e1322 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d1337331e1320 d1337331e1322 ">Interrupt handler</td>
<td class="entry" valign="top" headers="d1337331e1320 d1337331e1322 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d1337331e1320 d1337331e1322 ">Signal handler</td>
<td class="entry" valign="top" headers="d1337331e1320 d1337331e1322 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d1337331e1320 d1337331e1322 ">Thread</td>
<td class="entry" valign="top" headers="d1337331e1320 d1337331e1322 ">Yes</td>
</tr>

</tbody>

</table>
</div>

</div>



<div class="section"><h2 class="title sectiontitle">Caveats:</h2>


<p class="p">
When <span class="keyword apiname">devctl()</span> fails, the effect of the failed command depends on the device driver.
The corresponding data might be transferred, partially transferred, or not transferred at all.
</p>


<p class="p">
The <span class="keyword apiname">devctl()</span> function was originally part of the POSIX 1003.1d draft standard;
but it was deprecated in the IEEE <strong class="ph b"><em class="ph i">Approved</em></strong> <em class="ph i">Draft 10</em> standard.
</p>

</div>


</div>


<div class="related-links"><div class="relinfo relconcepts"><strong>Related concepts</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.prog/topic/process_proc_filesystem.html" title="Controlling processes via the /proc filesystem (QNX Neutrino Programmer's Guide)">Controlling processes via the /proc filesystem (<span class="keyword">QNX Neutrino</span> Programmer's Guide)</a></div>
</div>
<div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/c/close.html" title="Close a file">close()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/g/getiovbase.html" title="Get the base member of an iov_t structure">GETIOVBASE()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/g/getiovlen.html" title="Get the length member of an iov_t structure">GETIOVLEN()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/ioctl.html" title="Control a device">ioctl(), vioctl()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/o/open.html" title="Open a file">open(), open64()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/p/posix_devctl.html" title="Control a device">posix_devctl()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/r/read.html" title="Read bytes from a file">read()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/s/setiov.html" title="Fill in the fields of an iov_t structure">SETIOV(), SETIOV_CONST()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/w/write.html" title="Write bytes to a file">write()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.devctl/topic/about.html" title="Devctl and Ioctl Commands">Devctl and Ioctl Commands</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-d.html" title="D"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">D</span></a></span>  </div>
</body>
</html>