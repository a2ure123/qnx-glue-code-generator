
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="fs_crypto_domain_hard_lock()" /><meta name="abstract" content="Lock a domain" /><meta name="description" content="Lock a domain" /><meta name="indexterms" content="fs_crypto_domain_hard_lock()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-f.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_check.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_add.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_add_flags.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_key_change.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_key_check.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_key_size.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_lock.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_query.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_remove.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_unlock.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_configure.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_ctrl.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_ctrl_access_grant.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_ctrl_access_revoke.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_get_flags.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_set_flags.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_enable_option.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_enable.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_file_get_domain.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_file_set_domain.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_key_gen.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_migrate_control.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_migrate_path.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_migrate_status.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_migrate_tag.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_set_logging.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.sys_arch/topic/fsys_encryption.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.utilities/topic/f/fsencrypt.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="fs_crypto_domain_hard_lock" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>fs_crypto_domain_hard_lock()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="fs_crypto_domain_hard_lock">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-f.html" title="F">F</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-f.html" title="F"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">F</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">fs_crypto_domain_hard_lock()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>


<div class="body refbody"><p class="shortdesc"><em class="ph i">Lock a domain</em></p>


<div class="section">
<p class="p">



</p>

</div>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>

<pre class="pre codeblock">
#include &lt;fs_crypto_api.h&gt;
#include &lt;sys/fs_crypto.h&gt;

int fs_crypto_domain_hard_lock(
    const char <var class="keyword varname">*path</var>,
    int <var class="keyword varname">domain</var>,
    int <var class="keyword varname">*preply</var>,
    unsigned <var class="keyword varname">flags</var>)
</pre>

</div>


<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">path</var></dt>

<dd class="dd">The path to the filesystem's mountpoint.</dd>




<dt class="dt dlterm"><var class="keyword varname">domain</var></dt>

<dd class="dd">The number of the domain that you want to lock.</dd>




<dt class="dt dlterm"><var class="keyword varname">preply</var></dt>

<dd class="dd">A pointer to a location where the function can store additional success or error information.</dd>




<dt class="dt dlterm"><var class="keyword varname">flags</var></dt>

<dd class="dd">Flags associated with the hard lock request. The flags must contain an action specifier, which
describes the hard lock action to take. <div class="p"> Valid action flags include : <ul class="ul" id="fs_crypto_domain_hard_lock__ul_nm4_ptx_mx">
<li class="li"><span class="keyword const">FS_CRYPTO_HARD_LOCK_ACTION_CANCEL</span> â Cancel a queued hard lock. This
effectively disables the whitelist that controls access to the domain when a hard lock is pending.
If a hard lock has not been queued, this action has no effect. This implies that the lock state
isn't changed by this action. For example, if the domain is already locked, this doesn't unlock the
domain since a hard lock can't be queued on a locked domain. </li>

<li class="li"><span class="keyword const">FS_CRYPTO_HARD_LOCK_ACTION_ENFORCE</span> â Enforce a hard lock of the domain
immediately. All filesystem clients are denied access to the keys associated with the domain. </li>

<li class="li"><span class="keyword const">FS_CRYPTO_HARD_LOCK_ACTION_QUEUE</span> â Queue the locking of the domain. All
filesystem clients that have not been whitelisted are denied access to the keys associated with the
domain. A queued hard lock can be enforced at a later time by sending an additional hard lock
request with FS_CRYPTO_HARD_LOCK_ENFORCE used as the enforcement flag. If no enforcement flag is
specified, this is the default behavior. </li>

</ul>
</div>
</dd>



</dl>


</div>


<div class="section"><h2 class="title sectiontitle">Library:</h2>


<p class="p"><span class="ph filepath">libfscrypto</span></p>

<p class="p">Use the <span class="keyword option">-l fscrypto</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library.</p>

</div>


<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p"> The <span class="keyword apiname">fs_crypto_domain_hard_lock()</span> function locks a domain. The behavior is
determined by when the hard lock (controlled by the
<span class="keyword const">FS_CRYPTO_HARD_LOCK_ACTION_ENFORCE</span> flag) takes place.</p>







<div class="note note"><span class="notetitle">Note:</span> 
<ul class="ul">
<li class="li">In order to use filesystem encryption, download the Encrypted Filesystem package from the QNX Software Center.</li>


<li class="li">You must be in the group that owns the filesystem's mountpoint in order to lock a domain.</li>


</ul>

</div>

<p class="p">If <span class="keyword const">FS_CRYPTO_HARD_LOCK_ACTION_ENFORCE</span> isn't set, the hard lock is deferred until a
later time (triggered or enforced by invoking this function with
<span class="keyword const">FS_CRYPTO_HARD_LOCK_ACTION_ENFORCE</span> set) at the discretion of the client. A deferred
hard lock activates the use of a whitelist that controls access to domain keys. Only clients that
appear on the whitelist can access the domain and file keys, and thus all file content that the keys
protect. Clients that do not appear on the whitelist are denied access to both the domain and file
keys, and thus all file content that they protect.</p>

<p class="p">If <span class="keyword const">FS_CRYPTO_HARD_LOCK_ACTION_ENFORCE</span> is set, the hard lock is enforced
immediately. All domain and file keys are securely cleared from memory, which means all clients
(including those that appear on the whitelist) are denied access to the file content that the keys
protect. When this action is complete, the state of the domain is equivalent to the usual locked
state.</p>

<p class="p">To make sure that filesystem metadata is updated consistently before the domain is locked, this
operation also flushes the entire filesystem.</p>


<p class="p">
This function sets the variable pointed to by <var class="keyword varname">preply</var> to one of the following values:
</p>


<dl class="dl">

<dt class="dt dlterm"><span class="keyword const">FS_CRYPTO_REPLY_ALREADY</span></dt>

<dd class="dd">The domain was already locked.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">FS_CRYPTO_REPLY_COMPLETE</span></dt>

<dd class="dd">The domain is now locked.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">FS_CRYPTO_REPLY_INVALID</span></dt>

<dd class="dd">The command wasn't completed successfully.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">FS_CRYPTO_REPLY_NOENTRY</span></dt>

<dd class="dd">No entry was found for the given domain.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">FS_CRYPTO_REPLY_UNKNOWN_TYPE</span></dt>

<dd class="dd">The type of encryption used for the domain is invalid.
  
</dd>



</dl>

</div>


<div class="section"><h2 class="title sectiontitle">Returns:</h2>


<dl class="dl">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">Invalid arguments.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOMEM</span></dt>

<dd class="dd">Insufficent free memory.</dd>



</dl>


<p class="p">
This function can also return any of the errors indicated by
<a class="xref" href="../d/devctl.html" title="Control a device"><span class="keyword apiname">devctl()</span></a>
or
<a class="xref" href="../o/open.html" title="Open a file"><span class="keyword apiname">open()</span></a>.
</p>

</div>


<div class="section"><h2 class="title sectiontitle">Classification:</h2>

<p class="p"><a class="xref" href="../summary.html#summary__CLASSIFICATION">QNX Neutrino</a></p>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr><th class="entry" valign="top" id="d1469765e350">Safety:</th>
<th class="entry" valign="top" id="d1469765e352">Â </th>
</tr>

</thead>

<tbody class="tbody">
<tr><td class="entry" valign="top" headers="d1469765e350 d1469765e352 ">Cancellation point</td>
<td class="entry" valign="top" headers="d1469765e350 d1469765e352 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d1469765e350 d1469765e352 ">Interrupt handler</td>
<td class="entry" valign="top" headers="d1469765e350 d1469765e352 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d1469765e350 d1469765e352 ">Signal handler</td>
<td class="entry" valign="top" headers="d1469765e350 d1469765e352 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d1469765e350 d1469765e352 ">Thread</td>
<td class="entry" valign="top" headers="d1469765e350 d1469765e352 ">Yes</td>
</tr>

</tbody>

</table>
</div>

</div>


</div>





<div class="related-links"><div class="relinfo relconcepts"><strong>Related concepts</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.sys_arch/topic/fsys_encryption.html" title="Encryption (System Architecture)">Encryption (System Architecture)</a></div>
</div>
<div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_check.html" title="Determine if the underlying filesystem supports encryption">fs_crypto_check()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_add.html" title="Create a domain">fs_crypto_domain_add()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_add_flags.html" title="Create an encryption domain and unlock it if requested">fs_crypto_domain_add_flags()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_key_change.html" title="Change the key needed to unlock the specified domain">fs_crypto_domain_key_change()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_key_check.html" title="Determine if a given domain key is valid">fs_crypto_domain_key_check()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_key_size.html" title="Return the size of keys needed by the filesystem encryption">fs_crypto_domain_key_size()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_lock.html" title="Lock a domain">fs_crypto_domain_lock()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_query.html" title="Get status information for a domain">fs_crypto_domain_query()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_remove.html" title="Destroy a domain">fs_crypto_domain_remove()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_unlock.html" title="Unlock a domain">fs_crypto_domain_unlock()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_configure.html" title="Perform whitelist configuration for a domain whitelist">fs_crypto_domain_whitelist_configure()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_ctrl.html" title="Perform a control action for a domain whitelist">fs_crypto_domain_whitelist_ctrl()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_ctrl_access_grant.html" title="Grant a client access to a domain">fs_crypto_domain_whitelist_ctrl_access_grant()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_ctrl_access_revoke.html" title="Revoke a client's access to a domain">fs_crypto_domain_whitelist_ctrl_access_revoke()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_get_flags.html" title="Get the flags for a domain whitelist">fs_crypto_domain_whitelist_get_flags()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_domain_whitelist_set_flags.html" title="Perform whitelist configuration for a domain whitelist">fs_crypto_domain_whitelist_set_flags()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_enable_option.html" title="Enable encryption support on a filesystem">fs_crypto_enable_option()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_enable.html" title="Enable encryption support on a filesystem">fs_crypto_enable()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_file_get_domain.html" title="Get the domain of a file or directory">fs_crypto_file_get_domain()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_file_set_domain.html" title="Set the domain of a file or directory">fs_crypto_file_set_domain()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_key_gen.html" title="Generate an encryption key from a password">fs_crypto_key_gen()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_migrate_control.html" title="Control encryption migration within the filesystem">fs_crypto_migrate_control()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_migrate_path.html" title="Mark an entire directory for migration into an encryption domain">fs_crypto_migrate_path()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_migrate_status.html" title="Get the status of migration in the filesystem">fs_crypto_migrate_status()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_migrate_tag.html" title="Mark a file for migration into an encryption domain">fs_crypto_migrate_tag()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fs_crypto_set_logging.html" title="Set the logging destination and verbosity">fs_crypto_set_logging()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.utilities/topic/f/fsencrypt.html" title="fsencrypt (Utilities Reference)">fsencrypt (Utilities Reference)</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-f.html" title="F"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">F</span></a></span>  </div>
</body>
</html>