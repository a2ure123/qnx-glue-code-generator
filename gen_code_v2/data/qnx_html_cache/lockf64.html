
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="lockf(), lockf64()" /><meta name="abstract" content="Lock or unlock a section of a file" /><meta name="description" content="Lock or unlock a section of a file" /><meta name="indexterms" content="lockf(), lockf64()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-l.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fcntl.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/flock.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/o/open.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="lockf" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>lockf(), lockf64()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="lockf">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-l.html" title="L">L</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-l.html" title="L"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">L</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">lockf()</span>, <span class="keyword apiname">lockf64()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>


<div class="body refbody"><p class="shortdesc"><em class="ph i">Lock or unlock a section of a file</em></p>


<div class="section">

<p class="p">






</p>

</div>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>

<pre class="pre codeblock">
#include &lt;unistd.h&gt;

int lockf( int <var class="keyword varname">filedes</var>,
           int <var class="keyword varname">function</var>,
           off_t <var class="keyword varname">size</var> );

int lockf64( int <var class="keyword varname">filedes</var>,
             int <var class="keyword varname">function</var>,
             off64_t <var class="keyword varname">size</var> );
</pre>

</div>



<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">filedes</var></dt>

<dd class="dd">The file descriptor for the file that you want to lock.
  Open the file with write-only permission 
  (<a class="xref" href="../o/open.html#open__O_WRONLY"><span class="keyword const">O_WRONLY</span></a>)
  or with read/write permission 
  (<a class="xref" href="../o/open.html#open__O_RDWR"><span class="keyword const">O_RDWR</span></a>).
</dd>




<dt class="dt dlterm"><var class="keyword varname">function</var></dt>

<dd class="dd">A control value that specifies the action to be taken. 
  The permissible values (defined in <span class="ph filepath">&lt;unistd.h&gt;</span>) 
  are as follows:

  <dl class="dl" compact="compact">
  
  <dt class="dt dlterm" id="lockf__F_LOCK"><span class="keyword const">F_LOCK</span></dt>

  <dd class="dd">Lock a section for exclusive use if the section is available.
    A read-only lock is one of
    <a class="xref" href="../o/open.html#open__O_RDONLY"><span class="keyword const">O_RDONLY</span></a>,
    <a class="xref" href="../o/open.html#open__O_WRONLY"><span class="keyword const">O_WRONLY</span></a>, or
    <a class="xref" href="../o/open.html#open__O_RDWR"><span class="keyword const">O_RDWR</span></a>.
    An exclusive lock is one of
    <a class="xref" href="../o/open.html#open__O_WRONLY"><span class="keyword const">O_WRONLY</span></a>, or
    <a class="xref" href="../o/open.html#open__O_RDWR"><span class="keyword const">O_RDWR</span></a>.
    (For descriptions of the locks, see 
     <a class="xref" href="../o/open.html" title="Open a file"><span class="keyword apiname">open()</span></a>).
    
  </dd>

  

  
  <dt class="dt dlterm" id="lockf__F_TEST"><span class="keyword const">F_TEST</span></dt>

  <dd class="dd">Test a specified section for locks obtained by other processes.
    
  </dd>

  

  
  <dt class="dt dlterm" id="lockf__F_TLOCK"><span class="keyword const">F_TLOCK</span></dt>

  <dd class="dd">Test and lock a section for exclusive use if the section is available.
    
  </dd>

  

  
  <dt class="dt dlterm" id="lockf__F_ULOCK"><span class="keyword const">F_ULOCK</span></dt>

  <dd class="dd">Remove locks from a specified section of the file.
    
  </dd>

  

  </dl>

</dd>




<dt class="dt dlterm"><var class="keyword varname">size</var></dt>

<dd class="dd">The number of contiguous bytes that you want to lock or unlock. 
  The section to be locked or unlocked starts at the current offset in the file
  and extends forward for a positive <var class="keyword varname">size</var> or backward for a negative <var class="keyword varname">size</var> 
  (the preceding bytes up to but not including the current offset). 
  If <var class="keyword varname">size</var> is 0, the section from the current offset through the largest possible file offset is
  locked (that is, from the current offset through to the present or any future end-of-file). 
  An area need not be allocated to the file to be locked because locks may exist past the end-of-file.
  
</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Library:</h2>


<p class="p"><span class="ph filepath">libc</span></p>


<p class="p">
Use the <span class="keyword option">-l c</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library.
This library is usually included automatically.
</p>

</div>



<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p">
You can use the <span class="keyword apiname">lockf()</span> function to lock a section of a file,
using advisory-mode locks.
If other threads call <span class="keyword apiname">lockf()</span> to try to lock the locked file
section, those calls
either return an error value or block until the section becomes unlocked.
The <span class="keyword apiname">lockf64()</span> function is a large-file version of
<span class="keyword apiname">lockf()</span>.
</p>


<p class="p">
All the locks for a process are removed when the process terminates. 
Record locking with <span class="keyword apiname">lockf()</span> is supported for regular files and may be supported for other files. 

</p>


<p class="p">
The sections locked with 
<a class="xref" href="#lockf__F_LOCK"><span class="keyword const">F_LOCK</span></a> 
or 
<a class="xref" href="#lockf__F_TLOCK"><span class="keyword const">F_TLOCK</span></a> 
may in whole or in part, 
contain or be contained by a previously locked section for the same process. 
When this occurs, or if adjacent locked sections occur, the sections are combined into a single locked section. 
</p>


<p class="p">
File locks are released on the first close by the locking process of any file descriptor for the file. 
</p>


<p class="p">
<a class="xref" href="#lockf__F_ULOCK"><span class="keyword const">F_ULOCK</span></a> 
requests may release (wholly or in part) one or more locked sections controlled by the process. 
Locked sections are unlocked starting at the current file offset through <var class="keyword varname">size</var> bytes 
or to the end of file if <var class="keyword varname">size</var> is 0.
When all of a locked section isn't released 
(that is, when the beginning or end of the area to be unlocked falls within a locked section), 
the remaining portions of that section are still locked by the process. 
Releasing the center portion of a locked section causes the remaining locked beginning
and end portions to become two separate locked sections. 
</p>


<p class="p">
A potential for deadlock occurs if the threads of a process controlling a 
locked section are blocked by accessing another process's locked section. 
If the system detects that deadlock could occur, 
<span class="keyword apiname">lockf()</span> fails with <span class="keyword const">EDEADLK</span>.
</p>


<p class="p">
The interaction between
<a class="xref" href="../f/fcntl.html" title="Provide control over an open file"><span class="keyword apiname">fcntl()</span></a>
and <span class="keyword apiname">lockf()</span> locks is undefined. 
Blocking on a section is interrupted by any signal.
</p>




<p class="p">
If <var class="keyword varname">size</var> is the maximum value of type <span class="keyword dtype">off_t</span> (or
<span class="keyword dtype">off64_t</span> for <span class="keyword apiname">lockf64()</span>) and
the process has an existing lock of size 0 in this range 
(indicating a lock on the entire file), then an 
<a class="xref" href="#lockf__F_ULOCK"><span class="keyword const">F_ULOCK</span></a> request is treated the same as an
<a class="xref" href="#lockf__F_ULOCK"><span class="keyword const">F_ULOCK</span></a> request of size 0.
Otherwise an 
<a class="xref" href="#lockf__F_ULOCK"><span class="keyword const">F_ULOCK</span></a> 
request attempts to unlock only the requested section. 
Attempting to lock a section of a file that's associated with a buffered stream produces undefined results.
</p>


</div>



<div class="section"><h2 class="title sectiontitle">Returns:</h2>


<dl class="dl" compact="compact">

<dt class="dt dlterm">0</dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm">-1</dt>

<dd class="dd">An error occurred (<a class="xref" href="../e/errno.html" title="Thread-local error variable"><var class="keyword varname">errno</var></a> is set).
  Existing locks aren't changed.
</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Errors:</h2>


<dl class="dl">

<dt class="dt dlterm"><span class="keyword const">EACCES</span> or <span class="keyword const">EAGAIN</span></dt>

<dd class="dd">The <var class="keyword varname">function</var> argument is 
  <a class="xref" href="#lockf__F_TLOCK"><span class="keyword const">F_TLOCK</span></a> 
  or 
  <a class="xref" href="#lockf__F_TEST"><span class="keyword const">F_TEST</span></a>
  and the section is already locked by another process.
</dd>




<dt class="dt dlterm"><span class="keyword const">EAGAIN</span>  </dt>

<dd class="dd">The <var class="keyword varname">function</var> argument is 
  <a class="xref" href="#lockf__F_LOCK"><span class="keyword const">F_LOCK</span></a> 
  or
  <a class="xref" href="#lockf__F_TLOCK"><span class="keyword const">F_TLOCK</span></a> 
  and the file is mapped with
  <a class="xref" href="../m/mmap.html" title="Map a memory region into a process's address space"><span class="keyword apiname">mmap()</span></a>.
</dd>




<dt class="dt dlterm"><span class="keyword const">EBADF</span></dt>

<dd class="dd">The <var class="keyword varname">filedes</var> argument isn't a valid open file descriptor; 
  or <var class="keyword varname">function</var> is 
  <a class="xref" href="#lockf__F_LOCK"><span class="keyword const">F_LOCK</span></a> 
  or 
  <a class="xref" href="#lockf__F_TLOCK"><span class="keyword const">F_TLOCK</span></a> 
  and <var class="keyword varname">filedes</var> isn't a valid file descriptor open for writing.
</dd>




<dt class="dt dlterm"><span class="keyword const">EDEADLK</span></dt>

<dd class="dd">The <var class="keyword varname">function</var> argument is 
  <a class="xref" href="#lockf__F_LOCK"><span class="keyword const">F_LOCK</span></a> 
  and a deadlock was detected.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINTR</span></dt>

<dd class="dd">A signal was caught during execution of the function.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The <var class="keyword varname">function</var> argument isn't one of 
  <a class="xref" href="#lockf__F_LOCK"><span class="keyword const">F_LOCK</span></a>,
  <a class="xref" href="#lockf__F_TLOCK"><span class="keyword const">F_TLOCK</span></a>, 
  <a class="xref" href="#lockf__F_TEST"><span class="keyword const">F_TEST</span></a> or
  <a class="xref" href="#lockf__F_ULOCK"><span class="keyword const">F_ULOCK</span></a>; 
  or <var class="keyword varname">size</var> plus the current file offset is less than 0.
</dd>




<dt class="dt dlterm"><span class="keyword const">ENOMEM</span></dt>

<dd class="dd">The system can't allocate sufficient memory to store lock resources.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The filesystem doesn't support the operation.</dd>




<dt class="dt dlterm"><span class="keyword const">EOPNOTSUPP</span> or <span class="keyword const">EINVAL</span></dt>

<dd class="dd">The implementation doesn't support the locking of files of the type
  indicated by <var class="keyword varname">filedes</var>.
</dd>




<dt class="dt dlterm"><span class="keyword const">EOVERFLOW</span></dt>

<dd class="dd">The offset of the first, or if <var class="keyword varname">size</var> isn't 0 then the last,
  byte in the requested section can't be represented correctly in an object of type <span class="keyword dtype">off_t</span>.
</dd>



</dl>


</div>




<div class="section"><h2 class="title sectiontitle">Classification:</h2>

<p class="p"><a class="xref" href="../summary.html#summary__CLASSIFICATION">POSIX 1003.1</a></p>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr><th class="entry" valign="top" id="d2119245e645">Safety:</th>
<th class="entry" valign="top" id="d2119245e647">Â </th>
</tr>

</thead>

<tbody class="tbody">
<tr><td class="entry" valign="top" headers="d2119245e645 d2119245e647 ">Cancellation point</td>
<td class="entry" valign="top" headers="d2119245e645 d2119245e647 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d2119245e645 d2119245e647 ">Interrupt handler</td>
<td class="entry" valign="top" headers="d2119245e645 d2119245e647 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d2119245e645 d2119245e647 ">Signal handler</td>
<td class="entry" valign="top" headers="d2119245e645 d2119245e647 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d2119245e645 d2119245e647 ">Thread</td>
<td class="entry" valign="top" headers="d2119245e645 d2119245e647 ">Yes</td>
</tr>

</tbody>

</table>
</div>

</div>


</div>





<div class="related-links"><div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fcntl.html" title="Provide control over an open file">fcntl()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/flock.html" title="Apply or remove an advisory lock on an open file">flock()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/o/open.html" title="Open a file">open(), open64()</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-l.html" title="L"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">L</span></a></span>  </div>
</body>
</html>