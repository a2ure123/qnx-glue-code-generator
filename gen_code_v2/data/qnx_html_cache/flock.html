
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="flock()" /><meta name="abstract" content="Apply or remove an advisory lock on an open file" /><meta name="description" content="Apply or remove an advisory lock on an open file" /><meta name="indexterms" content="flock()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-f.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fcntl.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/l/lockf.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/o/open.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="flock" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>flock()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="flock">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-f.html" title="F">F</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-f.html" title="F"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">F</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">flock()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>



<div class="body refbody"><p class="shortdesc"><em class="ph i">Apply or remove an advisory lock on an open file</em></p>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>

<pre class="pre codeblock">
#include &lt;fcntl.h&gt;

int flock( int <var class="keyword varname">filedes</var>,
           int <var class="keyword varname">operation</var> );
</pre>

</div>



<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">


<dt class="dt dlterm"><var class="keyword varname">filedes</var></dt>

<dd class="dd">The file descriptor of an open file.</dd>




<dt class="dt dlterm"><var class="keyword varname">operation</var></dt>

<dd class="dd">What you want to do to the file; one of the following:

  <ul class="ul">
  <li class="li" id="flock__LOCK_EX"><span class="keyword const">LOCK_EX</span>âapply an exclusive lock.
    
  </li>


  <li class="li" id="flock__LOCK_SH"><span class="keyword const">LOCK_SH</span>âapply a shared lock.
    
  </li>


  <li class="li" id="flock__LOCK_UN"><span class="keyword const">LOCK_UN</span>âunlock an existing lock.
    
    
    
  </li>


  </ul>


  <p class="p" id="flock__LOCK_NB">
  You can OR <span class="keyword const">LOCK_NB</span> with <span class="keyword const">LOCK_EX</span> or <span class="keyword const">LOCK_SH</span>
  to prevent the function from blocking (see below).
  
  </p>


</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Library:</h2>


<p class="p"><span class="ph filepath">libc</span></p>

<p class="p">Use the <span class="keyword option">-l c</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library.
This library is usually included automatically.</p>

</div>



<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p">




The <span class="keyword apiname">flock()</span> function applies or removes an advisory lock on the file 
associated with the open file descriptor <var class="keyword varname">filedes</var>.
</p>


<p class="p">
Advisory locks allow cooperating processes to perform consistent operations on files, 
but they don't guarantee consistency.
</p>


<p class="p">


The locking mechanism allows two types of locks: <em class="ph i">shared</em> and <em class="ph i">exclusive</em>.
At any time, multiple shared locks may be applied to a file, 
but at no time are multiple exclusive, or both shared and exclusive, locks allowed simultaneously on a file.
</p>


<p class="p">
A shared lock may be upgraded to an exclusive lock, and vice versa, 
by specifying the appropriate lock type. 
The previous lock is released and a new lock is applied 
(possibly after other processes have gained and released the lock).
</p>


<p class="p">
Requesting a lock on an object that's already locked causes the
caller to be blocked until the lock may be acquired.  
If you don't want the caller to be blocked, you can specify <span class="keyword const">LOCK_NB</span>
in the operation to make the call fail instead (<var class="keyword varname">errno</var> is set to
<span class="keyword const">EWOULDBLOCK</span>).
</p>


<div class="note note"><span class="notetitle">Note:</span> 
Locks are applied to files, not file descriptors.  
That is, file descriptors duplicated through 
<a class="xref" href="../d/dup.html" title="Duplicate a file descriptor"><span class="keyword apiname">dup()</span></a> or 
<a class="xref" href="fork.html" title="Create a new process"><span class="keyword apiname">fork()</span></a>
don't result in multiple instances of a lock, 
but rather multiple references to a single lock.  
If a process holding a lock on a file forks, and the child explicitly unlocks the file,
the parent loses its lock.

<p class="p">
In QNX Neutrino 7.0 or later, if you open the same file multiple times in a process, an <span class="keyword apiname">flock()</span>
on one file descriptor referring to a file locks out an <span class="keyword apiname">flock()</span> on a different fd.
</p>

</div>


<p class="p">
Processes blocked awaiting a lock may be awakened by signals.
</p>

</div>



<div class="section"><h2 class="title sectiontitle">Returns:</h2>


<dl class="dl" compact="compact">


<dt class="dt dlterm">0</dt>

<dd class="dd">The operation was successful.</dd>




<dt class="dt dlterm">-1</dt>

<dd class="dd">An error occurred (<a class="xref" href="../e/errno.html" title="Thread-local error variable"><var class="keyword varname">errno</var></a> is set).</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Errors:</h2>


<dl class="dl">


<dt class="dt dlterm"><span class="keyword const">EBADF</span></dt>

<dd class="dd">Invalid descriptor, <var class="keyword varname">filedes</var>.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The argument operation doesn't include one of 
  <span class="keyword const">LOCK_EX</span>, <span class="keyword const">LOCK_SH</span>, or <span class="keyword const">LOCK_UN</span>.
</dd>




<dt class="dt dlterm"><span class="keyword const">ENOMEM</span></dt>

<dd class="dd">The system can't allocate sufficient memory to store lock resources.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The filesystem doesn't support the operation.</dd>




<dt class="dt dlterm"><span class="keyword const">EOPNOTSUPP</span></dt>

<dd class="dd">The <var class="keyword varname">filedes</var> argument refers to an object other than a file.</dd>




<dt class="dt dlterm"><span class="keyword const">EWOULDBLOCK</span></dt>

<dd class="dd">The file is already locked, and <span class="keyword const">LOCK_NB</span> was specified.</dd>



</dl>


</div>




<div class="section"><h2 class="title sectiontitle">Classification:</h2>

<p class="p"><a class="xref" href="../summary.html#summary__CLASSIFICATION">Unix</a></p>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr><th class="entry" valign="top" id="d1443355e380">Safety:</th>
<th class="entry" valign="top" id="d1443355e382">Â </th>
</tr>

</thead>

<tbody class="tbody">
<tr><td class="entry" valign="top" headers="d1443355e380 d1443355e382 ">Cancellation point</td>
<td class="entry" valign="top" headers="d1443355e380 d1443355e382 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d1443355e380 d1443355e382 ">Interrupt handler</td>
<td class="entry" valign="top" headers="d1443355e380 d1443355e382 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d1443355e380 d1443355e382 ">Signal handler</td>
<td class="entry" valign="top" headers="d1443355e380 d1443355e382 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d1443355e380 d1443355e382 ">Thread</td>
<td class="entry" valign="top" headers="d1443355e380 d1443355e382 ">Yes</td>
</tr>

</tbody>

</table>
</div>

</div>


</div>





<div class="related-links"><div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/fcntl.html" title="Provide control over an open file">fcntl()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/l/lockf.html" title="Lock or unlock a section of a file">lockf(), lockf64()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/o/open.html" title="Open a file">open(), open64()</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-f.html" title="F"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">F</span></a></span>  </div>
</body>
</html>