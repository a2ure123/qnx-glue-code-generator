
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="pthread_cond_timedwait()" /><meta name="abstract" content="Wait on a condition variable, with a time limit" /><meta name="description" content="Wait on a condition variable, with a time limit" /><meta name="indexterms" content="pthread_cond_timedwait()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-p.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.sys_arch/topic/kernel_Condvars.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.getting_started/topic/s1_procs.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.getting_started/topic/s1_timer.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/n/nsec2timespec.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_broadcast.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_clockwait.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_init.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_signal.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_wait.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_condattr_setclock.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/s/synccondvarwait.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/t/timertimeout.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/t/timespec.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/t/timespec2nsec.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="pthread_cond_timedwait" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>pthread_cond_timedwait()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="pthread_cond_timedwait">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-p.html" title="P">P</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-p.html" title="P"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">P</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">pthread_cond_timedwait()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>


<div class="body refbody"><p class="shortdesc"><em class="ph i">Wait on a condition variable, with a time limit</em></p>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>

<pre class="pre codeblock">
#include &lt;pthread.h&gt;
#include &lt;time.h&gt;

int pthread_cond_timedwait(
            pthread_cond_t* <var class="keyword varname">cond</var>,
            pthread_mutex_t* <var class="keyword varname">mutex</var>,
            const struct timespec* <var class="keyword varname">abstime</var> );
</pre>

</div>



<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">cond</var></dt>

<dd class="dd">The condition variable on which to block the thread.</dd>




<dt class="dt dlterm"><var class="keyword varname">mutex</var></dt>

<dd class="dd">The mutex associated with the condition variable.</dd>




<dt class="dt dlterm"><var class="keyword varname">abstime</var></dt>

<dd class="dd">A pointer to a
  <a class="xref" href="../t/timespec.html" title="Time-specification structure"><span class="keyword dtype">timespec</span></a>
  structure that specifies the absolute time at which the timeout is to expire.
</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Library:</h2>


<p class="p"><span class="ph filepath">libc</span></p>


<p class="p">
Use the <span class="keyword option">-l c</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library.
This library is usually included automatically.
</p>

</div>



<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p">




The <span class="keyword apiname">pthread_cond_timedwait()</span> function blocks the calling
thread on the condition variable <var class="keyword varname">cond</var>, and unlocks the
associated mutex <var class="keyword varname">mutex</var>. The calling thread must have locked
<var class="keyword varname">mutex</var> before waiting on the condition variable. Upon return
from the function, the mutex is again locked and owned by the
calling thread.
</p>


<p class="p">
The calling thread is blocked until either another thread performs
a signal or broadcast on the condition variable, the absolute time
specified by <var class="keyword varname">abstime</var> has passed, a signal is delivered to the
thread, or the thread is canceled (waiting on a condition variable is a cancellation point).
In all cases, the thread reacquires the mutex before being unblocked.
</p>


<p class="p">
To specify the clock source for the condvar, call
<a class="xref" href="pthread_condattr_setclock.html" title="Set the clock attribute of a condition-variable attribute object"><span class="keyword apiname">pthread_condattr_setclock()</span></a>.
As discussed in
<span class="q">&#147;<a class="xref" href="../../../com.qnx.doc.neutrino.getting_started/topic/s1_timer_Advanced.html">Advanced topics</a>&#148;</span>
in the Clocks, Timers, and Getting a Kick Every So Often
chapter of <cite class="cite">Getting Started with <span class="keyword">QNX Neutrino</span></cite>,
<span class="keyword const">CLOCK_MONOTONIC</span> isn't affected by changes to the system time;
the default, <span class="keyword const">CLOCK_REALTIME</span>, is.
</p>


<p class="p">
If you want to choose the clock against which the timeout is measured, you can 
instead use <a class="xref" href="pthread_cond_clockwait.html" title="Wait on a condition variable, with a time limit measured against a specific clock"><span class="keyword apiname">pthread_cond_clockwait()</span></a>, 
which is similar to <span class="keyword apiname">pthread_cond_timedwait()</span> 
and differs only because of its clock parameter (<var class="keyword varname">clk</var>). Choosing the clock prevents the 
timeout from being affected by changes to the system time.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
Don't use a recursive mutex with condition variables.
</div>


<p class="p">
If a thread that's blocked on a condition variable is canceled,
the thread reacquires the mutex that's guarding the condition variable, so
that the thread's cleanup handlers run in the same state as the critical
code before and after the call to this function.
If some other thread owns the lock, the canceled thread blocks until the
mutex is available.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
<ul class="ul">
<li class="li">Make sure that the thread's cleanup handlers unlock the mutex.</li>


<li class="li">To specify a timeout of less than a second, obtain the current time using
  <a class="xref" href="../c/clock_gettime.html" title="Get the current time of a clock"><span class="keyword apiname">clock_gettime()</span></a>,
  and then add the number of nanoseconds to the <var class="keyword varname">abstime.tv_nsec</var> field.
</li>


<li class="li">You can use
  <a class="xref" href="../n/nsec2timespec.html" title="Convert nanoseconds to a timespec structure"><span class="keyword apiname">nsec2timespec()</span></a>
  to convert times in nanoseconds to a <span class="keyword dtype">timespec</span> structure (and
  <a class="xref" href="../t/timespec2nsec.html" title="Convert a timespec structure to nanoseconds"><span class="keyword apiname">timespec2nsec()</span></a>
  to convert them back again).
</li>


</ul>

</div>


</div>



<div class="section"><h2 class="title sectiontitle">Returns:</h2>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success, or the call was interrupted by a signal.</dd>




<dt class="dt dlterm"><span class="keyword const">EFAULT</span></dt>

<dd class="dd">A fault occurred trying to access the buffers provided.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">One or both of the following are true:

  <ul class="ul">
  <li class="li">One or more of <var class="keyword varname">cond</var>, <var class="keyword varname">mutex</var>, and <var class="keyword varname">abstime</var>
    is invalid.
  </li>


  <li class="li">The mutex has died; see
    <a class="xref" href="../s/syncmutexevent.html" title="Attach an event to a mutex"><span class="keyword apiname">SyncMutexEvent()</span></a>.
  </li>


  </ul>


</dd>




<dt class="dt dlterm"><span class="keyword const">EPERM</span></dt>

<dd class="dd">The current thread doesn't own the mutex.</dd>




<dt class="dt dlterm"><span class="keyword const">ETIMEDOUT</span></dt>

<dd class="dd">The time specified by <var class="keyword varname">abstime</var> has passed.</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Examples:</h2>


<p class="p">
Wait five seconds while trying to acquire control over a condition variable:
</p>


<pre class="pre codeblock">
#include &lt;errno.h&gt;
#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;
#include &lt;unistd.h&gt;

pthread_mutex_t m = PTHREAD_MUTEX_INITIALIZER;
pthread_cond_t c;

int main(int argc, char* argv[])
{
    struct timespec to;
    int retval;
    pthread_condattr_t attr;

    fprintf(stderr, "starting...\n");

    /* Set up the condvar attributes to use CLOCK_MONOTONIC. */

    pthread_condattr_init( &amp;attr);
    pthread_condattr_setclock( &amp;attr, CLOCK_MONOTONIC);
    pthread_cond_init( &amp;c, &amp;attr);

    /*
     Here's the interesting bit; we'll wait for
     five seconds FROM NOW when we call 
     pthread_cond_timedwait().
    */
    clock_gettime(CLOCK_MONOTONIC, &amp;to);
    to.tv_sec += 5;

    if ((retval = pthread_mutex_lock(&amp;m))) {
        fprintf(stderr, "pthread_mutex_lock %s\n", 
                strerror(retval));

        exit(EXIT_FAILURE);
    }

    if ((retval = pthread_cond_timedwait(&amp;c, &amp;m, &amp;to)))
    {
        fprintf(stderr, "pthread_cond_timedwait %s\n",
                strerror(retval));

        exit(EXIT_FAILURE);
    }

    if ((retval = pthread_mutex_unlock(&amp;m))) {
        fprintf(stderr, "pthread_mutex_unlock %s\n", 
                strerror(retval));

        exit(EXIT_FAILURE);
    }
 
    return EXIT_SUCCESS;
}
</pre>


</div>



<div class="section"><h2 class="title sectiontitle">Classification:</h2>

<p class="p"><a class="xref" href="../summary.html#summary__CLASSIFICATION">POSIX 1003.1</a></p>




<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr><th class="entry" valign="top" id="d2404812e377">Safety:</th>
<th class="entry" valign="top" id="d2404812e379">Â </th>
</tr>

</thead>

<tbody class="tbody">
<tr><td class="entry" valign="top" headers="d2404812e377 d2404812e379 ">Cancellation point</td>
<td class="entry" valign="top" headers="d2404812e377 d2404812e379 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d2404812e377 d2404812e379 ">Interrupt handler</td>
<td class="entry" valign="top" headers="d2404812e377 d2404812e379 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d2404812e377 d2404812e379 ">Signal handler</td>
<td class="entry" valign="top" headers="d2404812e377 d2404812e379 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d2404812e377 d2404812e379 ">Thread</td>
<td class="entry" valign="top" headers="d2404812e377 d2404812e379 ">Yes</td>
</tr>

</tbody>

</table>
</div>

</div>


</div>





<div class="related-links"><div class="relinfo relconcepts"><strong>Related concepts</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.sys_arch/topic/kernel_Condvars.html" title="Condvars: condition variables (System Architecture)">Condvars: condition variables (System Architecture)</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.getting_started/topic/s1_procs.html" title="Processes and Threads (Getting Started with QNX Neutrino)">Processes and Threads (Getting Started with <span class="keyword">QNX Neutrino</span>)</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.getting_started/topic/s1_timer.html" title="Clocks, Timers, and Getting a Kick Every So Often (Getting Started with QNX Neutrino)">Clocks, Timers, and Getting a Kick Every So Often (Getting Started with <span class="keyword">QNX Neutrino</span>)</a></div>
</div>
<div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/n/nsec2timespec.html" title="Convert nanoseconds to a timespec structure">nsec2timespec()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_broadcast.html" title="Unblock threads waiting on a condition">pthread_cond_broadcast()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_clockwait.html" title="Wait on a condition variable, with a time limit measured against a specific clock">pthread_cond_clockwait()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_init.html" title="Initialize a condition variable">pthread_cond_init()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_signal.html" title="Unblock a thread that's waiting on a condition variable">pthread_cond_signal()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_cond_wait.html" title="Wait on a condition variable">pthread_cond_wait()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/p/pthread_condattr_setclock.html" title="Set the clock attribute of a condition-variable attribute object">pthread_condattr_setclock()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/s/synccondvarwait.html" title="Block a thread on a synchronization object">SyncCondvarWait(), SyncCondvarWait_r()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/t/timertimeout.html" title="Set a timeout on a blocking state">TimerTimeout(), TimerTimeout_r()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/t/timespec.html" title="Time-specification structure">timespec</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/t/timespec2nsec.html" title="Convert a timespec structure to nanoseconds">timespec2nsec()</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-p.html" title="P"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">P</span></a></span>  </div>
</body>
</html>