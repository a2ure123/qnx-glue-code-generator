
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="InterruptLock()" /><meta name="abstract" content="Guard a critical section in an interrupt handler" /><meta name="description" content="Guard a critical section in an interrupt handler" /><meta name="indexterms" content="InterruptLock()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-i.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.prog/topic/inthandler.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.getting_started/topic/s1_inter.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptdisable.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptenable.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptmask.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptunlock.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptunmask.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/t/threadctl.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="interruptlock" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>InterruptLock()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="interruptlock">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-i.html" title="I">I</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-i.html" title="I"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">I</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">InterruptLock()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>


<div class="body refbody"><p class="shortdesc"><em class="ph i">Guard a critical section in an interrupt handler</em></p>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>

<pre class="pre codeblock">
#include &lt;sys/neutrino.h&gt;

void InterruptLock( intrspin_t* <var class="keyword varname">spinlock</var> );
</pre>

</div>



<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">spinlock</var></dt>

<dd class="dd">The spinlock (a variable shared between the interrupt handler and a thread) to use.

  <div class="note note"><span class="notetitle">Note:</span> 
  If <var class="keyword varname">spinlock</var> isn't a <span class="keyword dtype">static</span> variable, you must
  initialize it by calling:

<pre class="pre codeblock">
memset( spinlock, 0, sizeof( *spinlock ) );
</pre>


  <p class="p">
  before using it with <span class="keyword apiname">InterruptLock()</span>.
  </p>

  </div>

</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Library:</h2>


<p class="p"><span class="ph filepath">libc</span></p>


<p class="p">
Use the <span class="keyword option">-l c</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library.
This library is usually included automatically.
</p>

</div>



<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p">



The <span class="keyword apiname">InterruptLock()</span> function guards a critical section
by locking the specified <var class="keyword varname">spinlock</var>.
You can call this function from a thread or from an interrupt handler.
Before calling this function:
</p>


<ul class="ul">
<li class="li">The process must have the <span class="keyword const">PROCMGR_AID_IO</span> ability enabled.
  For more information, see
  <a class="xref" href="../p/procmgr_ability.html" title="Control a process's ability to perform certain operations"><span class="keyword apiname">procmgr_ability()</span></a>.
  
</li>


<li class="li">The calling thread must have obtained I/O privileges by calling:
<pre class="pre codeblock">
ThreadCtl( _NTO_TCTL_IO_LEVEL, (void*)_NTO_IO_LEVEL_1 );
</pre>

  
  
  
  
  
  
</li>


</ul>


<p class="p">
If you don't do these things, the thread might <span class="keyword const">SIGSEGV</span>
when it calls <span class="keyword apiname">InterruptLock()</span>.
</p>


<p class="p">
This function tries to acquire the <var class="keyword varname">spinlock</var> (a variable shared
between the interrupt handler and a thread) while interrupts are disabled.
The code spins in a tight loop until the lock is acquired. It's
important to release the lock as soon as possible. Typically, this
is a few lines of code without any loops:
</p>


<pre class="pre codeblock">
InterruptLock( &amp;spinner );

/* ... critical section */

InterruptUnlock( &amp;spinner );
</pre>


<p class="p">
<span class="keyword apiname">InterruptLock()</span> solves a common need in many realtime
systems to protect access to shared data structures between an
interrupt handler and the thread that owns the handler.  The traditional
POSIX primitives used between threads aren't available for use by an interrupt handler.
</p>


<p class="p">
The <span class="keyword apiname">InterruptLock()</span> and <span class="keyword apiname">InterruptUnlock()</span>
functions work on single-processor or multiprocessor machines.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
<ul class="ul">
<li class="li">You should disable interrupts for as little time as possible (i.e., the minimum time you need to access
  or deal with the hardware).
  Failure to do so may result in increased interrupt latency and the inability to meet realtime deadlines.
  
</li>


<li class="li">Some kernel calls and library routines reenable interrupts.
  Masked interrupts aren't affected.
</li>


<li class="li">
This function doesn't support nesting.
If a specific thread calls <span class="keyword apiname">InterruptLock()</span> multiple times with different
spinlocks and then calls <span class="keyword apiname">InterruptUnlock()</span> the same number of times
and in reverse order with the locks, the first <span class="keyword apiname">InterruptUnlock()</span> call
reenables interrupts and the critical section is no longer protected.
</li>


</ul>

</div>


</div>



<div class="section"><h2 class="title sectiontitle">Classification:</h2>

<p class="p"><a class="xref" href="../summary.html#summary__CLASSIFICATION">QNX Neutrino</a></p>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr><th class="entry" valign="top" id="d1994613e267">Safety:</th>
<th class="entry" valign="top" id="d1994613e269">Â </th>
</tr>

</thead>

<tbody class="tbody">
<tr><td class="entry" valign="top" headers="d1994613e267 d1994613e269 ">Cancellation point</td>
<td class="entry" valign="top" headers="d1994613e267 d1994613e269 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d1994613e267 d1994613e269 ">Interrupt handler</td>
<td class="entry" valign="top" headers="d1994613e267 d1994613e269 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d1994613e267 d1994613e269 ">Signal handler</td>
<td class="entry" valign="top" headers="d1994613e267 d1994613e269 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d1994613e267 d1994613e269 ">Thread</td>
<td class="entry" valign="top" headers="d1994613e267 d1994613e269 ">Yes</td>
</tr>

</tbody>

</table>
</div>

</div>


</div>


<div class="related-links"><div class="relinfo relconcepts"><strong>Related concepts</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.prog/topic/inthandler.html" title="Writing an Interrupt Handler (QNX Neutrino Programmer's Guide)">Writing an Interrupt Handler (<span class="keyword">QNX Neutrino</span> Programmer's Guide)</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.getting_started/topic/s1_inter.html" title="Interrupts (Getting Started with QNX Neutrino)">Interrupts (Getting Started with <span class="keyword">QNX Neutrino</span>)</a></div>
</div>
<div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptdisable.html" title="Disable hardware interrupts">InterruptDisable()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptenable.html" title="Enable hardware interrupts">InterruptEnable()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptmask.html" title="Disable a hardware interrupt">InterruptMask()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptunlock.html" title="Release a critical section in an interrupt handler">InterruptUnlock()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/i/interruptunmask.html" title="Enable a hardware interrupt">InterruptUnmask()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/t/threadctl.html" title="Control a thread">ThreadCtl(), ThreadCtl_r(), ThreadCtlExt(), ThreadCtlExt_r()</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-i.html" title="I"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">I</span></a></span>  </div>
</body>
</html>