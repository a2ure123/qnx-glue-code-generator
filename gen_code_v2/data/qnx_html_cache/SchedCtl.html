
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="SchedCtl(), SchedCtl_r()" /><meta name="abstract" content="Control the scheduler" /><meta name="description" content="Control the scheduler" /><meta name="indexterms" content="SchedCtl(), SchedCtl_r()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-s.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.adaptivepartitioning.userguide/topic/about_howtouseguide_.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/s/schedget.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/s/schedinfo.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/s/schedset.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/s/schedyield.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/s/sigevent.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.utilities/topic/a/aps.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="schedctl" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>SchedCtl(), SchedCtl_r()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="schedctl">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-s.html" title="S">S</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-s.html" title="S"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">S</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">SchedCtl()</span>, <span class="keyword apiname">SchedCtl_r()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>



<div class="body refbody"><p class="shortdesc"><em class="ph i">Control the scheduler</em></p>

<div class="section">
<p class="p">






</p>

</div>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>


<pre class="pre codeblock">
#include &lt;sys/sched_aps.h&gt;
#include &lt;sys/neutrino.h&gt;

int SchedCtl( int <var class="keyword varname">cmd</var>,
              void *<var class="keyword varname">data</var>,
              int <var class="keyword varname">length</var>);

int SchedCtl_r( int <var class="keyword varname">cmd</var>,
                void *<var class="keyword varname">data</var>,
                int <var class="keyword varname">length</var>);
</pre>

</div>


<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">cmd</var></dt>

<dd class="dd">The control command that you want to execute; one of:

  <ul class="ul">
  <li class="li"><a class="xref" href="#schedctl__SCHED_CONFIGURE"><span class="keyword const">SCHED_CONFIGURE</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_CONT_APP"><span class="keyword const">SCHED_CONT_APP</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_CONT_APP"><span class="keyword const">SCHED_STOP_APP</span></a></li>

  </ul>


  <p class="p">
  If you've loaded the adaptive partitioning module into your OS image, the following commands are also available:
  </p>


  <ul class="ul">
  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_QUERY_PARMS"><span class="keyword const">SCHED_APS_QUERY_PARMS</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_SET_PARMS"><span class="keyword const">SCHED_APS_SET_PARMS</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_CREATE_PARTITION"><span class="keyword const">SCHED_APS_CREATE_PARTITION</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_LOOKUP"><span class="keyword const">SCHED_APS_LOOKUP</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_QUERY_PARTITION"><span class="keyword const">SCHED_APS_QUERY_PARTITION</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_JOIN_PARTITION"><span class="keyword const">SCHED_APS_JOIN_PARTITION</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_MODIFY_PARTITION"><span class="keyword const">SCHED_APS_MODIFY_PARTITION</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_PARTITION_STATS"><span class="keyword const">SCHED_APS_PARTITION_STATS</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_OVERALL_STATS"><span class="keyword const">SCHED_APS_OVERALL_STATS</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_QUERY_THREAD"><span class="keyword const">SCHED_APS_QUERY_THREAD</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_ADD_SECURITY"><span class="keyword const">SCHED_APS_ADD_SECURITY</span></a></li>

  <li class="li"><a class="xref" href="#schedctl__SCHED_APS_QUERY_PROCESS"><span class="keyword const">SCHED_APS_QUERY_PROCESS</span></a></li>

  </ul>

</dd>




<dt class="dt dlterm"><var class="keyword varname">data</var></dt>

<dd class="dd">A pointer to the specific data structure for the command.</dd>




<dt class="dt dlterm"><var class="keyword varname">length</var></dt>

<dd class="dd">The size of the structure that <var class="keyword varname">data</var> points to.</dd>



</dl>


<p class="p">
For details about each command and its data, see the sections below.
</p>

</div>


<div class="section"><h2 class="title sectiontitle">Library:</h2>

<p class="p"><span class="ph filepath">libc</span></p>


<p class="p">
Use the <span class="keyword option">-l c</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library. This library is usually included automatically.
</p>

</div>


<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p">
The <span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> kernel calls control the scheduler.
These functions are identical except in the way they indicate errors;
see the <a class="xref" href="#schedctl__Returns">Returns</a> section for details.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
<p class="p">
The adaptive partitioning scheduler is optional and is present only if you add <samp class="ph codeph">[module=aps]</samp> to
your OS image's buildfile.
For more information, see the Adaptive Partitioning
<a class="xref" href="../../../com.qnx.doc.adaptivepartitioning.userguide/topic/about_howtouseguide_.html"><em class="ph i">User's Guide</em></a>.
</p>

<p class="p">

For the control commands that are related to adaptive partitioning,
you must initialize all of the fieldsâincluding reserved onesâin the structures you pass as the
<var class="keyword varname">data</var> argument, by calling (for example)
<a class="xref" href="../m/memset.html" title="Set memory to a given value"><span class="keyword apiname">memset()</span></a>.
You can also use the <span class="keyword apiname">APS_INIT_DATA()</span> macro:
</p>


<pre class="pre codeblock">
APS_INIT_DATA( &amp;data );
</pre>

</div>



<p class="p" id="schedctl__SCHED_APS_QUERY_PARMS"><strong class="ph b"><span class="keyword const">SCHED_APS_QUERY_PARMS</span></strong></p>


<p class="p">



This command fills in a <span class="keyword dtype">sched_aps_info</span> structure that describes the overall parameters of the
adaptive partitioning scheduler:
</p>


<pre class="pre codeblock">
typedef struct {
    uint64_t        cycles_per_ms;
    uint64_t        windowsize_cycles;   /* Deprecated */
    uint64_t        windowsize2_cycles;  /* Deprecated */
    uint64_t        windowsize3_cycles;  /* Deprecated */
    uint32_t        scheduling_policy_flags;
    uint32_t        sec_flags;
    uint32_t        bankruptcy_policy;
    uint16_t        num_partitions;
    uint16_t        max_partitions;
    uint16_t        windowsize_ms;
    uint16_t        reserved1;       
    uint32_t        reserved2;
    uint64_t        reserved3;
} sched_aps_info;
</pre>


<p class="p">
The members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">cycles_per_ms</var></dt>

<dd class="dd">The number of machine cycles in a millisecond. Use this value to convert the output of the
  <a class="xref" href="#schedctl__SCHED_APS_QUERY_PARTITION"><span class="keyword const">SCHED_APS_QUERY_PARTITION</span></a>
  command to the time units of your choice.

   <div class="note note"><span class="notetitle">Note:</span> 
   The value of <var class="keyword varname">cycles_per_ms</var>:

   <ul class="ul">
   <li class="li">might not equal the value of the <var class="keyword varname">cycles_per_sec</var> member of the
     system page divided by 1000
    </li>


    <li class="li">isn't necessarily in the same units as values returned by
      <span class="keyword apiname">ClockCycles()</span> on all platforms
    </li>

    </ul>

    </div>

</dd>




<dt class="dt dlterm"><var class="keyword varname">scheduling_policy_flags</var></dt>

<dd class="dd">The set of <span class="keyword const">SCHED_APS_SCHEDPOL_*</span> flags that describe the scheduling policy.
  For more information, see
  <span class="q">&#147;<a class="xref" href="#schedctl__Scheduling_policies">Scheduling policies</a>,&#148;</span> below.
</dd>




<dt class="dt dlterm"><var class="keyword varname">sec_flags</var></dt>

<dd class="dd">The set of <span class="keyword const">SCHED_APS_SEC_*</span> flags that describe the security options.
  For more information, see <span class="q">&#147;<a class="xref" href="#schedctl__Security">Security</a>,&#148;</span> below.
</dd>




<dt class="dt dlterm"><var class="keyword varname">bankruptcy_policy</var></dt>

<dd class="dd">What to do if a partition exhausts its critical budget; a combination of
  <span class="keyword const">SCHED_APS_BNKR_*</span> flags (see
  <span class="q">&#147;<a class="xref" href="#schedctl__Bankruptcy">Handling bankruptcy</a>,&#148;</span> below).
</dd>




<dt class="dt dlterm"><var class="keyword varname">num_partitions</var></dt>

<dd class="dd">The number of partitions defined.</dd>




<dt class="dt dlterm"><var class="keyword varname">max_partitions</var></dt>

<dd class="dd">The largest number of partitions that may be created at any time.</dd>




<dt class="dt dlterm"><var class="keyword varname">windowsize_ms</var></dt>

<dd class="dd">The length of the averaging window used for scheduling, in milliseconds.</dd>



</dl>


<p class="p" id="schedctl__Scheduling_policies"><strong class="ph b">Scheduling policies</strong></p>


<p class="p">

These flags set options for the adaptive partitioning scheduling algorithm.
To set, pass a pointer to an ORed set of these flags with the
<a class="xref" href="#schedctl__SCHED_APS_SET_PARMS"><span class="keyword const">SCHED_APS_SET_PARMS</span></a>
call to <span class="keyword apiname">SchedCtl()</span>:
</p>


<dl class="dl">

<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SCHEDPOL_FREETIME_BY_RATIO</span></dt>

<dd class="dd"><em class="ph i">Free time</em> is when at least one partition isn't running.
  Its time becomes free to other partitions that may then run over their budgets.
  
     
  <p class="p">
  By default, the scheduler hands out free time to the partition with the
  highest-priority running thread. That guarantees realtime scheduling behavior (i.e.,
  scheduling strictly by priority) to partitions any time they aren't being limited by
  some other partition's right to its guaranteed minimum budget. But it also means that
  one partition is allowed to grab all the free time.
  </p>

      
  <p class="p">
  If you set <span class="keyword const">SCHED_APS_SCHEDPOL_FREETIME_BY_RATIO</span>, the running
  partitions share the free time in proportion to the ratios of their budgets. So, one
  partition can no longer grab all the free time. However, when this flag is set,
  partitions will see strict priority-scheduling between partitions only when they're
  consuming less than their CPU budgets.
</p>

</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SCHEDPOL_DEFAULT</span></dt>

<dd class="dd">The default policy, which currently means that
  <span class="keyword const">SCHED_APS_SCHEDPOL_FREETIME_BY_RATIO</span> isn't set,
  long-window reporting is enabled, and all maximum budgets are 100%.
  <span class="keyword">QNX Neutrino</span> sets this at startup.
    
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SCHEDPOL_PARTITION_LOCAL_PRIORITIES</span></dt>

<dd class="dd">Normally, the APS scheduler always selects the highest-priority thread from
  partitions with available budget.
  That algorithm produces behavior closest to realtime scheduling.
  In particular, it allows the highest-priority partition to run to completion
  (as long as it keeps under its budget).
    

  <p class="p">
  Allowing the highest-priority partition to run to completion means
  lower-priority partitions won't run in the meantime.
  That means that when the system is loaded, the default algorithm can
  cause small-budget low-priority partitions to see long delays between
  intervals when they run.
  (For example, on a loaded system with a 100 ms averaging window,
  a 10% partition may run only every 90 milliseconds.)
  One way to reduce the latency is to reduce the averaging window size.
  </p>


  <p class="p">
  The <span class="keyword const">SCHED_APS_SCHEDPOL_PARTITION_LOCAL_PRIORITIES</span> policy
  schedules purely by budget ratio.
  When enabled, the scheduler tries to balance budgets on as short a timescale
  as possible, regardless of the window size.
  </p>


  <p class="p">
  That means high-priority partitions with large budgets no longer run
  to completion (while they have budget).
  They're timesliced with other partitions, even low-priority ones.
  The result is that <span class="keyword const">SCHED_APS_SCHEDPOL_PARTITION_LOCAL_PRIORITIES</span> can
  reduce the latencies seen by small budget partitions in a loaded system.
  This comes at the cost of a departure from strict priority preemptive behavior
  when all partitions have budget (i.e., the default policy).
  </p>


  <p class="p">
  The <span class="keyword const">SCHED_APS_SCHEDPOL_PARTITION_LOCAL_PRIORITIES</span> policy
  provides the latencies while retaining the full accuracy of a 100 ms
  averaging window.
  It continues to schedule the highest priority thread within partitions.
  </p>

  
  <p class="p">
  This option includes the behavior of <span class="keyword const">SCHED_APS_SCHEDPOL_FREETIME_BY_RATIO</span>.
  </p>


  <p class="p">
  When a critical thread consumes critical time, it temporarily forces a
  return to the default scheduling policy.
  Critical threads are allowed to run to completion and aren't timesliced by
  <span class="keyword const">SCHED_APS_SCHEDPOL_PARTITION_LOCAL_PRIORITIES</span>'s
  attempts to balance budgets.
  In other words, critical threads aren't affected by this policy.
  </p>


  <div class="note note"><span class="notetitle">Note:</span> 
  Don't use this scheduling policy if you have running threads in a
  zero-budget partition.
  Since this policy divides time by the ratio of budgets, a zero-budget partition
  may never be scheduled.
  </div>

</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SCHEDPOL_LIMIT_CPU_USAGE</span></dt>

<dd class="dd">Enable enforcement of the <var class="keyword varname">max_budget_percent</var> parameters, which limit the amount
  a partition can overrun its normal budget when the system is underloaded.
  If this option isn't set, <var class="keyword varname">max_budget_percent</var> is ignored when you're setting parameters,
  and is reported as 100% (meaning no limit on freetime usage).
    

  <div class="note note"><span class="notetitle">Note:</span> 
  Threads in a partition with a normal budget of 0 and a <var class="keyword varname">max_budget_percent</var> of 0 will never run.
  </div>

</dd>



</dl>


<p class="p">
Scheduling within a partition is always strictly by priority, no matter which of these flags are set.
</p>


<p class="p">
For more information about adaptive partitioning and BMP, see the
<a class="xref" href="../../../com.qnx.doc.adaptivepartitioning.userguide/topic/aps_details_Base_.html">Adaptive Partitioning Scheduling Details</a>
chapter of the Adaptive Partitioning <cite class="cite">User's Guide</cite>.
</p>


<p class="p" id="schedctl__Bankruptcy"><strong class="ph b">Handling bankruptcy</strong></p>


<p class="p">


Bankruptcy is when critical CPU time billed to a partition exceeds its critical budget.
Bankruptcy is always considered to be a design error on the part of the application, but you can configure how
the system responds to it.
</p>


<p class="p">
If the system isn't declaring bankruptcy when you expect it, note that bankruptcy can be
declared only if critical time is billed to your partition.
Critical time is billed on those timeslices when the following conditions are <em class="ph i">all</em> met:
</p>


<ul class="ul">
<li class="li">The partition of the running thread has a critical budget greater than zero.</li>

<li class="li">The running thread has a critical priority.</li>

<li class="li">The partition must be out of percentage-CPU budget.</li>

<li class="li">There be at least one other partition that is competing for CPU time.</li>


</ul>


<p class="p">
Only then if the critical time, billed over the current averaging window, exceeds a
partition's critical budget will the system declare the partition bankrupt.
</p>


<p class="p">
When the system detects that a partition has gone bankrupt:
</p>


<ol class="ol">
<li class="li">It causes that partition to be out-of-budget for the remainder of the current scheduling window.</li>


<li class="li">If you've set a <span class="keyword dtype">sigevent</span> via
  <a class="xref" href="../p/procmgr_event_notify.html" title="Ask to be notified of system-wide events"><span class="keyword apiname">procmgr_event_notify()</span></a>
  or
  <a class="xref" href="../p/procmgr_event_notify_add.html" title="Add a request to be notified of system-wide events"><span class="keyword apiname">procmgr_event_notify_add()</span></a>
  with a flag of <span class="keyword const">PROCMGR_EVENT_APS_BANKRUPTCY</span>, the system delivers the event.
  
  
  
  
</li>


</ol>


<p class="p">
In addition, you can configure the following responses:
</p>


<dl class="dl">

<dt class="dt dlterm"><span class="keyword const">SCHED_APS_BNKR_BASIC</span></dt>

<dd class="dd">Deliver bankruptcy-notification events and make the partition out-of-budget for the
  rest of the scheduling window (nominally 100 ms). This is the default.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_BNKR_CANCEL_BUDGET</span></dt>

<dd class="dd">Set the offending partition's critical budget to zero, which forces the partition to
  be scheduled by its percentage CPU budget only.
  This also means that a second bankruptcy can't occur.
  This persists until a restart occurs, or you call
  <a class="xref" href="#schedctl__SCHED_APS_MODIFY_PARTITION"><span class="keyword const">SCHED_APS_MODIFY_PARTITION</span></a>
  to set a new critical budget.
  
  
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_BNKR_REBOOT</span></dt>

<dd class="dd">Cause the system to crash with a brief message identifying the offending partition.
  This is the most severe response, suggested for use while testing a product, to make
  sure bankruptcies are never ignored.
  You probably shouldn't use this option in your finished product.
  
  
  
</dd>



</dl>


<p class="p">
To set a choice of bankruptcy-handling options, OR the above <span class="keyword const">SCHED_APS_BNKR_*</span> flags
and pass a pointer to it as the <var class="keyword varname">bankruptcy_policyp</var> field of the <span class="keyword dtype">sched_aps_parms</span>
structure when you call
<a class="xref" href="#schedctl__SCHED_APS_SET_PARMS"><span class="keyword const">SCHED_APS_SET_PARMS</span></a>.
</p>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_QUERY_PARMS</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EACCES</span></dt>

<dd class="dd">The calling thread doesn't meet the security options set (see
  <a class="xref" href="#schedctl__SCHED_APS_ADD_SECURITY"><span class="keyword const">SCHED_APS_ADD_SECURITY</span></a>).
  Your process must have the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability (see
  <a class="xref" href="../p/procmgr_ability.html" title="Control a process's ability to perform certain operations"><span class="keyword apiname">procmgr_ability()</span></a>).
</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_SET_PARMS"><strong class="ph b"><span class="keyword const">SCHED_APS_SET_PARMS</span></strong></p>


<p class="p">



This command sets the parameters for the overall behavior of the adaptive partitioning scheduler.
The <var class="keyword varname">data</var> argument must be a pointer to a <span class="keyword dtype">sched_aps_parms</span> structure:
</p>


<pre class="pre codeblock">
typedef struct { 
    int16_t windowsize_ms;
    int16_t     reserved1;
    uint32_t    *scheduling_policy_flagsp;
    uint32_t    *bankruptcy_policyp;
    int32_t     reserved2;
    int64_t     reserved3;
} sched_aps_parms;
</pre>


<p class="p">
The members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">windowsize_ms</var></dt>

<dd class="dd">The time over which the scheduler is to average CPU cycles and balance the partitions
  to their budgets as specified by
  <a class="xref" href="#schedctl__SCHED_APS_CREATE_PARTITION"><span class="keyword const">SCHED_APS_CREATE_PARTITION</span></a>.
  The default is 100 ms.
  If you don't want to set the window size, set this member to -1.
</dd>




<dt class="dt dlterm"><var class="keyword varname">scheduling_policy_flagsp</var></dt>

<dd class="dd">A pointer to an ORed set of <span class="keyword const">SCHED_APS_SCHEDPOL_*</span> flags that specify the scheduling policy.
  For more information, see
  <span class="q">&#147;<a class="xref" href="#schedctl__Scheduling_policies">Scheduling policies</a>,&#148;</span> above.
  If you don't want to change the scheduling policy, set this member to <span class="keyword const">NULL</span>.
</dd>




<dt class="dt dlterm"><var class="keyword varname">bankruptcy_policyp</var></dt>

<dd class="dd">A pointer to an ORing of <span class="keyword const">SCHED_APS_BNKR_*</span> flags, as described under
  <span class="q">&#147;<a class="xref" href="#schedctl__Bankruptcy">Handling bankruptcy</a>,&#148;</span> above.
  If you don't want to change these flags, set this member to <span class="keyword const">NULL</span>.
</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_SET_PARMS</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EACCES</span></dt>

<dd class="dd">One of the following:

  <ul class="ul">
  <li class="li"><span class="keyword const">SCHED_APS_SEC_PARTITIONS_LOCKED</span> is set.</li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_ROOT0_OVERALL</span> is set, and you aren't running in the
    System partition with the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability (see
    <a class="xref" href="../p/procmgr_ability.html" title="Control a process's ability to perform certain operations"><span class="keyword apiname">procmgr_ability()</span></a>).
  </li>

  </ul>

      
  <p class="p">
  For more information, see <span class="q">&#147;<a class="xref" href="#schedctl__Security">Security</a>,&#148;</span> below.
  </p>

</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_CREATE_PARTITION"><strong class="ph b"><span class="keyword const">SCHED_APS_CREATE_PARTITION</span></strong></p>


<p class="p">





This command creates a new partition that's considered to be a child of the partition that's calling
<span class="keyword apiname">SchedCtl()</span>.
The system automatically creates a partition called <samp class="ph codeph">System</samp> (the value of
<span class="keyword const">APS_SYSTEM_PARTITION_NAME</span>) with an ID of 0.
</p>


<p class="p">

The <var class="keyword varname">data</var> argument for this command must be a pointer to a <span class="keyword dtype">sched_aps_create_parms</span>
structure:
</p>


<pre class="pre codeblock">
typedef struct {
    /* input parms */ 
    char        *name;
    uint16_t    budget_percent;
    int16_t     critical_budget_ms;
    uint8_t     aps_create_flags;
    int8_t      parent_id;
    uint16_t    max_budget_percent;
    uint16_t    critical_priority;
    uint16_t    budget_percent_scale;
    uint64_t    reserved1;
    uint32_t    reserved2;
    /* output parms */
    int16_t     id;
    int16_t     reserved3;
} sched_aps_create_parms;
</pre>


<p class="p">
The input members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">name</var></dt>

<dd class="dd">The name of the new partition.
  If <var class="keyword varname">name</var> is <span class="keyword const">NULL</span> or points to an empty string, the partition's name is the
  same as its ID.
  The name must be no longer than <span class="keyword const">APS_PARTITION_NAME_LENGTH</span>, not including the
  trailing null character, can't start with a digit, and can't include any slashes (<tt class="ph tt">/</tt>).
  
  
  
</dd>




<dt class="dt dlterm"><var class="keyword varname">budget_percent</var></dt>

<dd class="dd">The percentage CPU budget for the new partition.
  Budgets given to the new partition are subtracted from the parent partition.

  <div class="note note"><span class="notetitle">Note:</span> 
  Before creating zero-budget partitions, read the cautions in
  <span class="q">&#147;<a class="xref" href="../../../com.qnx.doc.adaptivepartitioning.userguide/topic/system_Resmgrs_.html">Setting budgets for resource managers</a>&#148;</span>
  in the System Considerations chapter of the Adaptive Partitioning <cite class="cite">User's Guide</cite>.
  </div>

</dd>




<dt class="dt dlterm"><var class="keyword varname">critical_budget_ms</var></dt>

<dd class="dd">The critical budget, in milliseconds, for the partition, or -1 or 0 if you don't want
  the partition to have a critical budget.
  Critical budgets don't affect the parent, but
  are automatically limited to be no bigger than the window size.
</dd>




<dt class="dt dlterm"><var class="keyword varname">aps_create_flags</var></dt>

<dd class="dd">Flags that control the creation of the partition.
  The only flag currently defined is:

  <ul class="ul">
  <li class="li"><span class="keyword const">APS_CREATE_FLAGS_USE_PARENT_ID</span> â if set, the <var class="keyword varname">parent_id</var> field is used;
    otherwise it's ignored.
    
  </li>


  </ul>

</dd>




<dt class="dt dlterm"><var class="keyword varname">parent_id</var></dt>

<dd class="dd">Which partition the budget should come from.
  If -1, then the budget comes from the calling thread's budget.
</dd>




<dt class="dt dlterm"><var class="keyword varname">max_budget_percent</var></dt>

<dd class="dd">The maximum CPU time, in percent, that the partition may consume if it has no competition (i.e., free time).
  This limit has an effect only if <span class="keyword const">SCHED_APS_SCHEDPOL_LIMIT_CPU_USAGE</span> is set.
</dd>




<dt class="dt dlterm"><var class="keyword varname">critical_priority</var></dt>

<dd class="dd">Threads at this priority or higher are critical.
  This value is optional; set it to -1 or 0 to disable.
</dd>




<dt class="dt dlterm"><var class="keyword varname">budget_percent_scale</var></dt>

<dd class="dd">The number of digits to the right of the decimal point in <var class="keyword varname">budget_percent</var> and
  <var class="keyword varname">max_budget_percent</var>. The budget is calculated as follows:
    <p class="p">Actual Budget (%) = <var class="keyword varname">budget_percent</var> / (10 ^ <var class="keyword varname">budget_percent_scale</var>)</p>

</dd>



</dl>


<p class="p">
The output members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">id</var></dt>

<dd class="dd">The created partition's ID number, in the range 0 to the maximum number of partitions
  â 1 (see the <var class="keyword varname">max_partitions</var> member of the data from a call to
  <a class="xref" href="#schedctl__SCHED_APS_QUERY_PARMS"><span class="keyword const">SCHED_APS_QUERY_PARMS</span></a>.
  The System partition's ID number is <span class="keyword const">APS_SYSTEM_PARTITION_ID</span>.
</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_CREATE_PARTITION</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EACCES</span></dt>

<dd class="dd"><span class="keyword const">SCHED_APS_SEC_PARTITIONS_LOCKED</span> is set, or any of these security
  conditions are set and not satisfied:

  <ul class="ul">
  <li class="li"><span class="keyword const">SCHED_APS_SEC_ROOT_MAKES_PARTITIONS</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_SYS_MAKES_PARTITIONS</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_NONZERO_BUDGETS</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_ROOT_MAKES_CRITICAL</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_SYS_MAKES_CRITICAL</span></li>

  </ul>

      
  <p class="p">
  For more information, see <span class="q">&#147;<a class="xref" href="#schedctl__Security">Security</a>,&#148;</span> below.
  </p>

</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EDQUOT</span></dt>

<dd class="dd">The parent partition doesn't have enough budget.</dd>




<dt class="dt dlterm"><span class="keyword const">EEXIST</span></dt>

<dd class="dd">Another partition is already using the given name.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure, the
  partition name is badly formed, or the budget is out of range.
</dd>




<dt class="dt dlterm"><span class="keyword const">ENAMETOOLONG</span></dt>

<dd class="dd">The partition name is longer than <span class="keyword const">APS_PARTITION_NAME_LENGTH</span> characters.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSPC</span></dt>

<dd class="dd">The maximum number of partitions already exist.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_QUERY_PARTITION"><strong class="ph b"><span class="keyword const">SCHED_APS_QUERY_PARTITION</span></strong></p>


<p class="p">



This command gets information about a given partition.
The <var class="keyword varname">data</var> argument for this command must be a
pointer to a <span class="keyword dtype">sched_aps_partition_info</span> structure:
</p>


<pre class="pre codeblock">
typedef struct { 
    /* out parms */ 
    uint64_t    budget_cycles;   /* Deprecated */      
    uint64_t    critical_budget_cycles; 
    char        name[APS_PARTITION_NAME_LENGTH+1]; 
    int16_t     parent_id;
    uint16_t    budget_percent;     
    int32_t     notify_pid;      /* Deprecated */      
    int32_t     notify_tid;      /* Deprecated */      
    uint32_t    pinfo_flags;     /* Deprecated */      
    int32_t     pid_at_last_bankruptcy;
    int32_t     tid_at_last_bankruptcy;
    uint16_t    max_budget_percent;
    uint16_t    critical_priority;
    uint16_t    budget_percent_scale;
    int16_t     reserved1;
    int64_t     reserved2;
    /* input parm */
    int16_t     id;
} sched_aps_partition_info; 
</pre>


<p class="p">
The input members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">id</var></dt>

<dd class="dd">The number of the partition you want to query.</dd>



</dl>


<p class="p">
The output members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">critical_budget_cycles</var></dt>

<dd class="dd">The critical budget, in cycles.
  To convert this value to milliseconds, multiply it by the <var class="keyword varname">cycles_per_ms</var> value from a
  <a class="xref" href="#schedctl__SCHED_APS_QUERY_PARMS"><span class="keyword const">SCHED_APS_QUERY_PARMS</span></a>
  command.</dd>




<dt class="dt dlterm"><var class="keyword varname">name</var></dt>

<dd class="dd">The name of the partition.</dd>




<dt class="dt dlterm"><var class="keyword varname">parent_id</var></dt>

<dd class="dd">The number of the partition that's the parent of the partition being queried.
  The System partition's ID number is <span class="keyword const">APS_SYSTEM_PARTITION_ID</span>.
</dd>




<dt class="dt dlterm"><var class="keyword varname">budget_percent</var></dt>

<dd class="dd">The partition's budget, expressed as a percentage.</dd>




<dt class="dt dlterm"><var class="keyword varname">pid_at_last_bankruptcy</var>, <var class="keyword varname">tid_at_last_bankruptcy</var></dt>

<dd class="dd">The process and thread IDs at the time of the last bankruptcy, or -1 if there wasn't a
  previous bankruptcy.
</dd>




<dt class="dt dlterm"><var class="keyword varname">max_budget_percent</var></dt>

<dd class="dd">The maximum CPU time, in percent, that the partition may consume if it has no competition (i.e., free time).
  This is always reported as 100% if <span class="keyword const">SCHED_APS_SCHEDPOL_LIMIT_CPU_USAGE</span> isn't set.
</dd>




<dt class="dt dlterm"><var class="keyword varname">critical_priority</var></dt>

<dd class="dd">Threads at this priority or higher are critical.</dd>




<dt class="dt dlterm"><var class="keyword varname">budget_percent_scale</var></dt>

<dd class="dd">The number of digits to the right of the decimal point in <var class="keyword varname">budget_percent</var> and
  <var class="keyword varname">max_budget_percent</var>.
</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_QUERY_PARTITION</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_LOOKUP"><strong class="ph b"><span class="keyword const">SCHED_APS_LOOKUP</span></strong></p>


<p class="p">


This command finds the partition ID for a given partition name.
</p>


<p class="p">

The <var class="keyword varname">data</var> argument for this command must be a <span class="keyword dtype">sched_aps_lookup_parms</span> structure:
</p>


<pre class="pre codeblock">
typedef struct {
        /* input parms */ 
        char    *name;
        int16_t reserved1;
        /* output parms */
        int16_t     id;
} sched_aps_lookup_parms;
</pre>


<p class="p">
The input members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">name</var></dt>

<dd class="dd">The name of the partition.</dd>



</dl>


<p class="p">
The output members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">id</var></dt>

<dd class="dd">The ID number of the partition, if found.</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_LOOKUP</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a>
section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The name wasn't found.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_JOIN_PARTITION"><strong class="ph b"><span class="keyword const">SCHED_APS_JOIN_PARTITION</span></strong></p>


<p class="p">





This command makes the thread specified by the given process and thread IDs becomes a member of
the specified partition.
This partition also becomes the thread's new home partition, i.e., where it returns after partition inheritance.
</p>


<p class="p">

The <var class="keyword varname">data</var> argument for this command must be a pointer to a <span class="keyword dtype">sched_aps_join_parms</span>
structure:
</p>


<pre class="pre codeblock">
typedef struct { 
        int16_t     id; 
        int16_t     reserved1;
        int32_t     pid;
        int32_t     tid;
        int32_t     aid;
} sched_aps_join_parms;
</pre>


<p class="p">
The members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">id</var></dt>

<dd class="dd">The ID number of the partition that the thread is to join.</dd>




<dt class="dt dlterm"><var class="keyword varname">pid</var>, <var class="keyword varname">tid</var></dt>

<dd class="dd">The process and thread IDs of the thread that you want to join the specified partition:

  <ul class="ul">
  <li class="li">If both <var class="keyword varname">pid</var> and <var class="keyword varname">tid</var> are zero, the calling
    thread joins the specified partition.
  </li>


  <li class="li">If <var class="keyword varname">tid</var> is -1, the process with ID <var class="keyword varname">pid</var> joins the partition.
    This doesn't change the partitions that the process's threads are in;
    it just sets the partition that the threads run in when they're handling a pulse.
    

    <p class="p">
    If <var class="keyword varname">tid</var> is -2, then the partition in which pulses are handled is changed, plus all threads
    in the given process are joined to the target partition.
    </p>

  </li>


  </ul>

</dd>




<dt class="dt dlterm"><var class="keyword varname">aid</var></dt>

  <dd class="dd">If non-zero, join all processes for this application ID. For 
    more information, see <a class="xref" href="../../../com.qnx.doc.security.system/topic/manual/application_groups.html">"Application groups"</a> in the <cite class="cite">QNX Neutrino System Security Guide</cite>.</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_JOIN_PARTITION</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EACCES</span></dt>

<dd class="dd">The following security options are set but not satisfied:

  <ul class="ul">
  <li class="li"><span class="keyword const">SCHED_APS_SEC_ROOT_JOINS</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_SYS_JOINS</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_PARENT_JOINS</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_JOIN_SELF_ONLY</span></li>

  </ul>

      
  <p class="p">
  For more information, see <span class="q">&#147;<a class="xref" href="#schedctl__Security">Security</a>,&#148;</span> below.
  </p>

</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">One of the following occurred:
  <ul class="ul">
    <li class="li">The size of the parameter block doesn't match the size of the expected structure, or
      the partition with the given ID doesn't exist.</li>

    <li class="li">The adaptive partitioning scheduler isn't installed.</li>

  </ul>

</dd>




<dt class="dt dlterm"><span class="keyword const">ESRCH</span></dt>

<dd class="dd">The <var class="keyword varname">pid</var> and <var class="keyword varname">tid</var> are invalid.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_MODIFY_PARTITION"><strong class="ph b"><span class="keyword const">SCHED_APS_MODIFY_PARTITION</span></strong></p>


<p class="p">



This command changes the parameters of an existing partition.
If the new budget's value is different from the current, the difference is either taken from,
or returned to, the parent partition's budget.
The critical time parameter affects only the chosen partition, not its parent.
To change just one of new budget or new critical time, set the other to -1.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
<ul class="ul">
<li class="li">You can't use this command to modify the System partition's budget. To increase the
  size of the System partition, reduce the budget of one of its child partitions.
</li>


<li class="li">Reducing the size of a partition may cause it not to run for the time of an averaging
  window, as you may have caused it to become temporarily over-budget. However, reducing
  the critical time doesn't trigger the declaration of bankruptcy.
</li>


</ul>

</div>


<p class="p">

The <var class="keyword varname">data</var> argument for this command must be a pointer to a <span class="keyword dtype">sched_aps_modify_parms</span>
structure:
</p>


<pre class="pre codeblock">
typedef struct { 
        int16_t     id;
        int16_t     new_budget_percent;
        int16_t     new_critical_budget_ms;
        int16_t     new_max_budget_percent;
        int16_t     new_critical_priority;
        uint16_t    budget_percent_scale;
        int32_t     reserved1;
        int64_t     reserved2;
} sched_aps_modify_parms; 
</pre>


<p class="p">
The members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">id</var></dt>

<dd class="dd">The ID number of the partition.</dd>




<dt class="dt dlterm"><var class="keyword varname">new_budget_percent</var></dt>

<dd class="dd">The new budget for the partition, expressed as a percentage, or -1 if you don't want to change it.</dd>




<dt class="dt dlterm"><var class="keyword varname">new_critical_budget_ms</var></dt>

<dd class="dd">The new critical budget, in milliseconds, for the partition, or -1 if you don't want to change it.
  If the critical budget is greater than the window size, it's considered to be infinite.
</dd>




<dt class="dt dlterm"><var class="keyword varname">max_budget_percent</var></dt>

<dd class="dd">The maximum CPU time, in percent, that the partition may consume if it has no competition (i.e., free time).
  This limit has an effect only if <span class="keyword const">SCHED_APS_SCHEDPOL_LIMIT_CPU_USAGE</span> is set.
</dd>




<dt class="dt dlterm"><var class="keyword varname">critical_priority</var></dt>

<dd class="dd">Threads at this priority or higher are critical.
  This value is optional; set it to -1 or 0 to skip.
</dd>




<dt class="dt dlterm"><var class="keyword varname">budget_percent_scale</var></dt>

<dd class="dd">The number of digits to the right of the decimal point in <var class="keyword varname">new_budget_percent</var> and
  <var class="keyword varname">max_budget_percent</var>.
</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_MODIFY_PARTITION</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EACCES</span></dt>

<dd class="dd"><span class="keyword const">SCHED_APS_SEC_PARTITIONS_LOCKED</span> is set, or the following
  security options are set and not satisfied:

  <ul class="ul">
  <li class="li"><span class="keyword const">SCHED_APS_SEC_PARENT_MODIFIES</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_ROOT_MAKES_PARTITIONS</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_SYS_MAKES_PARTITIONS</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_NONZERO_BUDGETS</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_ROOT_MAKES_CRITICAL</span></li>

  <li class="li"><span class="keyword const">SCHED_APS_SEC_SYS_MAKES_CRITICAL</span></li>

  </ul>

      
  <p class="p">
  For more information, see <span class="q">&#147;<a class="xref" href="#schedctl__Security">Security</a>,&#148;</span> below.
  </p>

</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure, or
  the partition with the given ID doesn't exist.
</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_PARTITION_STATS"><strong class="ph b"><span class="keyword const">SCHED_APS_PARTITION_STATS</span></strong></p>


<p class="p">




This command returns instantaneous values of the CPU time-accounting variables for a set of partitions.
It can fill in data for more than one partition.
If the <var class="keyword varname">length</var> argument to <span class="keyword apiname">SchedCtl()</span> indicates that
you've passed the function an array of
<span class="keyword dtype">sched_aps_partition_stats</span> structures, <span class="keyword apiname">SchedCtl()</span> fills
each element with statistics for a different partition, starting with the partition
specified by the <var class="keyword varname">id</var> field.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
To get an accurate picture for the whole machine it's important to read data for
all partitions in one call, since sequential calls to
<span class="keyword const">SCHED_APS_PARTITION_STATS</span> may come from separate averaging windows. 

<p class="p">
To determine the number of partitions, use the
<a class="xref" href="#schedctl__SCHED_APS_OVERALL_STATS"><span class="keyword const">SCHED_APS_OVERALL_STATS</span></a> command.
</p>

</div>


<p class="p">
The command overwrites the <var class="keyword varname">id</var> field with the partition number for which
data is being returned. It stores -1 in the <var class="keyword varname">id</var> field of unused elements.
</p>


<p class="p">
To convert times in cycles into milliseconds, divide them by the <var class="keyword varname">cycles_per_ms</var> obtained with an
<a class="xref" href="#schedctl__SCHED_APS_QUERY_PARMS"><span class="keyword const">SCHED_APS_QUERY_PARMS</span></a>
command.
</p>


<p class="p">
The <var class="keyword varname">data</var> argument for this command must be a pointer to a
<span class="keyword dtype">sched_aps_partition_stats</span> structure, or an array of these structures:
</p>


<pre class="pre codeblock">
typedef struct { 
    /* out parms */ 
    uint64_t        run_time_cycles;
    uint64_t        critical_time_cycles;
    uint64_t        run_time_cycles_w2;        /* Deprecated */
    uint64_t        critical_time_cycles_w2;   /* Deprecated */
    uint64_t        run_time_cycles_w3;        /* Deprecated */
    uint64_t        critical_time_cycles_w3;   /* Deprecated */
    uint32_t        stats_flags;
    uint32_t        reserved1;
    uint64_t        dynamic_windowsize_cycles;	/* length of last averaging window used for scheduling */
    uint64_t        reserved2;
    /* in parm */
    int16_t     id;
} sched_aps_partition_stats;
</pre>


<p class="p">
The members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">run_time_cycles</var></dt>

<dd class="dd">The CPU execution time during the last scheduling window.</dd>




<dt class="dt dlterm"><var class="keyword varname">critical_time_cycles</var></dt>

<dd class="dd">The time billed as critical during the last scheduling window.</dd>




<dt class="dt dlterm"><var class="keyword varname">stats_flags</var></dt>

<dd class="dd">A set of the following flags:

  <ul class="ul">
  <li class="li"><span class="keyword const">SCHED_APS_PSTATS_IS_BANKRUPT_NOW</span> â the critical time used is
    greater than the critical budget at the time you used the
    <span class="keyword const">SCHED_APS_PARTITION_STATS</span> command.
    
  </li>


  <li class="li"><span class="keyword const">SCHED_APS_PSTATS_WAS_BANKRUPT</span> â the partition was declared
    bankrupt sometime since the last restart.
    
  </li>


  </ul>

</dd>




<dt class="dt dlterm"><var class="keyword varname">dynamic_windowsize_cycles</var></dt>

<dd class="dd">The length of last averaging window used for scheduling.
  Note that <var class="keyword varname">dynamic_windowsize_cycles</var> may differ from the nominal window size.
  Use <var class="keyword varname">dynamic_windowsize_cycles</var> to convert <var class="keyword varname">run_time_cycles</var> to a percentage.
</dd>




<dt class="dt dlterm"><var class="keyword varname">id</var></dt>

<dd class="dd">This is both an input and output field.
  As input, it's the ID number of the first partition you want data for.
  If you've passed an array of <span class="keyword dtype">sched_aps_partition_stats</span> structures, the command fills in the ID
  number for each partition that it fills in statistics for.
</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_PARTITION_STATS</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block isn't a multiple of <samp class="ph codeph">size(sched_aps_partition_stats)</samp>.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_OVERALL_STATS"><strong class="ph b"><span class="keyword const">SCHED_APS_OVERALL_STATS</span></strong></p>


<p class="p">



This command returns instantaneous information about scheduler states.
The <var class="keyword varname">data</var> argument for this command must be a pointer to a <span class="keyword dtype">sched_aps_overall_stats</span>
structure:
</p>


<pre class="pre codeblock">
typedef struct { 
        uint64_t    idle_cycles;     /* Deprecated */
        uint64_t    idle_cycles_w2;  /* Deprecated */
        uint64_t    idle_cycles_w3;  /* Deprecated */
        int16_t     id_at_last_bankruptcy;
        uint16_t    reserved1;
        int32_t     pid_at_last_bankruptcy;
        int32_t     tid_at_last_bankruptcy;
        uint32_t    reserved2;
        uint32_t    reserved3;
        uint64_t    reserved4;
} sched_aps_overall_stats;
</pre>


<p class="p">
The members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">id_at_last_bankruptcy</var></dt>

<dd class="dd">The ID of last bankrupt partition, or -1 if no bankruptcy has occurred.</dd>




<dt class="dt dlterm"><var class="keyword varname">pid_at_last_bankruptcy</var>, <var class="keyword varname">tid_at_last_bankruptcy</var></dt>

<dd class="dd">The process and thread IDs at last the bankruptcy, or -1 if no bankruptcy has occurred.</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_OVERALL_STATS</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_QUERY_THREAD"><strong class="ph b"><span class="keyword const">SCHED_APS_QUERY_THREAD</span></strong></p>


<p class="p">





This command determines the partition for the given thread and indicates whether or not the thread in
your process is marked to run as critical.
Use a thread ID of zero to indicate the calling thread.
</p>


<p class="p">

The <var class="keyword varname">data</var> argument for this command must be a pointer to a
<span class="keyword dtype">sched_aps_query_thread_parms</span> structure:
</p>


<pre class="pre codeblock">
typedef struct { 
        int32_t     pid;
        int32_t     tid;
        /* out parms: */
        int16_t     id;
        int16_t     inherited_id;
        uint32_t    crit_state_flags;
        int32_t     reserved1;
        int32_t     reserved2;
} sched_aps_query_thread_parms;
</pre>


<p class="p">
The input members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">pid</var></dt>

<dd class="dd">The ID of process that the thread belongs to, or 0 to indicate the calling process.</dd>




<dt class="dt dlterm"><var class="keyword varname">tid</var></dt>

<dd class="dd">The thread ID, or 0 for the calling thread.</dd>



</dl>


<p class="p">
The output members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">id</var></dt>

<dd class="dd">The ID number of the partition that the thread originally joined.</dd>




<dt class="dt dlterm"><var class="keyword varname">inherited_id</var></dt>

<dd class="dd">The ID number of the partition that the thread currently belongs to.
  This might not be the same as the <var class="keyword varname">id</var> member, because the thread might have inherited
  the partition from a calling process.
</dd>




<dt class="dt dlterm"><var class="keyword varname">crit_state_flags</var></dt>

<dd class="dd">A combination of the following flags:

  <ul class="ul">
  <li class="li"><span class="keyword const">APS_QCRIT_RUNNING_CRITICAL</span> â the thread is currently running as critical.
    
  </li>


  <li class="li"><span class="keyword const">APS_QCRIT_BILL_AS_CRITICAL</span> â the thread's execution time is
    being billed to the partition's critical budget.
    
  </li>


  </ul>

</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_QUERY_THREAD</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>




<dt class="dt dlterm"><span class="keyword const">ESRCH</span></dt>

<dd class="dd">The specified thread wasn't found.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_ADD_SECURITY"><strong class="ph b"><span class="keyword const">SCHED_APS_ADD_SECURITY</span></strong></p>


<p class="p">



This command sets security options.
A bit that's set turns the corresponding security option on.
Successive calls add to the existing set of security options.
Security options can be cleared only by a restart.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
You must be running in the System partition with the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled (see
<a class="xref" href="../p/procmgr_ability.html" title="Control a process's ability to perform certain operations"><span class="keyword apiname">procmgr_ability()</span></a>)
in order to use this command, even if all security options are off.
</div>


<p class="p">

The <var class="keyword varname">data</var> argument for this command must be a pointer to a <span class="keyword dtype">sched_aps_security_parms</span>
structure:
</p>


<pre class="pre codeblock">
typedef struct {
        uint32_t        sec_flags;
        uint32_t        reserved1;
        uint32_t        reserved2;
} sched_aps_security_parms;
</pre>


<p class="p">
The members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">sec_flags</var></dt>

<dd class="dd">A set of <span class="keyword const">SCHED_APS_SEC_*</span> flags (see below), as both input and output parameters.
  Set this member to 0 if you want to get the current security flags.
</dd>



</dl>


<p class="p" id="schedctl__Security"><strong class="ph b">Security</strong></p>


<p class="p">




The adaptive partitioning scheduler lets you dynamically create and modify the partitions in your system.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
We recommend that you set up your partition environment at boot time, and then lock all parameters:

<ul class="ul">
<li class="li">in a program, by using the <span class="keyword const">SCHED_APS_SEC_PARTITIONS_LOCKED</span> flag</li>


<li class="li">from the command line, by using the
  <a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/a/aps.html"><span class="keyword cmdname">aps modify</span></a>
  command
</li>


</ul>

</div>


<p class="p">
However you might need to modify a partition at runtime.
In this case, you can use the security options described below.
</p>


<p class="p">

When <span class="keyword">QNX Neutrino</span> starts, it sets the security option to <span class="keyword const">SCHED_APS_SEC_OFF</span>.
We recommend that you immediately set it to <span class="keyword const">SCHED_APS_SEC_RECOMMENDED</span>.
In code, do this:
</p>


<pre class="pre codeblock">
sched_aps_security_parms p;

APS_INIT_DATA( &amp;p );
p.sec_flags = SCHED_APS_SEC_RECOMMENDED;
SchedCtl( SCHED_APS_ADD_SECURITY,&amp;p, sizeof(p) );
</pre>


<div class="note note"><span class="notetitle">Note:</span> 
Some of the security options restrict certain operations to processes that have the
<span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled (see
<a class="xref" href="../p/procmgr_ability.html" title="Control a process's ability to perform certain operations"><span class="keyword apiname">procmgr_ability()</span></a>).
</div>


<p class="p">
The security options include the following:
</p>


<dl class="dl">

<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_RECOMMENDED</span></dt>

<dd class="dd">Only a process that's running in the System partition with the
  <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled may create partitions or change parameters.
  This arranges a 2-level hierarchy of partitions: the System partition and its children.
  Only a process that's running in the System partition with the
  <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled may join its own thread to partitions.
  The percentage budgets must not be zero.
  
  
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_FLEXIBLE</span></dt>

<dd class="dd">Only a process that's running in the System partition with the
  <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled can change scheduling parameters.
  But a process that's running in <em class="ph i">any</em> partition with
  the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled can create subpartitions, join
  threads into its own subpartitions, modify subpartitions, and change critical budgets.
  This lets applications
  create their own local subpartitions out of their own budgets. The percentage budgets
  must not be zero. 
  
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_BASIC</span></dt>

<dd class="dd">Only a process that's running in the System partition with the
  <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled may change overall scheduling
  parameters.
  Only a process with the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled may set critical budgets.
  
</dd>



</dl>


<p class="p">
Unless you're testing the partitioning and want to change all parameters without needing
to restart, you should set at least <span class="keyword const">SCHED_APS_SEC_BASIC</span>.
</p>


<p class="p">
In general, <span class="keyword const">SCHED_APS_SEC_RECOMMENDED</span> is more secure than
<span class="keyword const">SCHED_APS_SEC_FLEXIBLE</span>, which is more secure than <span class="keyword const">SCHED_APS_SEC_BASIC</span>.
All three allow partitions to be created and modified.
After setting up partitions, use <span class="keyword const">SCHED_APS_SEC_PARTITIONS_LOCKED</span> to prevent
further unauthorized changes. For example:
</p>


<pre class="pre codeblock">
sched_aps_security_parms p; 

APS_INIT_DATA( &amp;p );
p.sec_flags = SCHED_APS_SEC_PARTITIONS_LOCKED;
SchedCtl( SCHED_APS_ADD_SECURITY, &amp;p, sizeof(p));
</pre>


<p class="p">
<span class="keyword const">SCHED_APS_SEC_RECOMMENDED</span>, <span class="keyword const">SCHED_APS_SEC_FLEXIBLE</span>, and
<span class="keyword const">SCHED_APS_SEC_BASIC</span> are composed of the flags defined below (but it's
usually more convenient for you to use the compound options):
</p>


<pre class="pre codeblock">
#define SCHED_APS_SEC_BASIC        (SCHED_APS_SEC_ROOT0_OVERALL | SCHED_APS_SEC_ROOT_MAKES_CRITICAL)

#define SCHED_APS_SEC_FLEXIBLE     (SCHED_APS_SEC_BASIC | SCHED_APS_SEC_NONZERO_BUDGETS |\
                                    SCHED_APS_SEC_ROOT_MAKES_PARTITIONS |\
                                    SCHED_APS_SEC_PARENT_JOINS | SCHED_APS_SEC_PARENT_MODIFIES )

#define SCHED_APS_SEC_RECOMMENDED  (SCHED_APS_SEC_FLEXIBLE | SCHED_APS_SEC_SYS_MAKES_PARTITIONS |\
                                    SCHED_APS_SEC_SYS_JOINS | SCHED_APS_SEC_JOIN_SELF_ONLY)

#define SCHED_APS_SEC_OFF          0x00000000
</pre>


<p class="p">
The individual flags are as follows:
</p>


<dl class="dl">

<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_ROOT0_OVERALL</span></dt>

<dd class="dd">Your process must have the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled and be
  running in the System partition in order to change the overall scheduling parameters,
  such as the averaging window size.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_ROOT_MAKES_PARTITIONS</span></dt>

<dd class="dd">Your process must have the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled in
  order to create or modify partitions.
  Applies to the
  <a class="xref" href="#schedctl__SCHED_APS_CREATE_PARTITION"><span class="keyword const">SCHED_APS_CREATE_PARTITION</span></a>
  and
  <a class="xref" href="#schedctl__SCHED_APS_MODIFY_PARTITION"><span class="keyword const">SCHED_APS_MODIFY_PARTITION</span></a>
  commands.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_SYS_MAKES_PARTITIONS</span></dt>

<dd class="dd">You must be running in the System partition in order to create or modify partitions.
  This applies to same commands as <span class="keyword const">SCHED_APS_SEC_ROOT_MAKES_PARTITIONS</span>.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_PARENT_MODIFIES</span></dt>

<dd class="dd">Allows partitions to be modified (<span class="keyword const">SCHED_APS_MODIFY_PARTITION</span>), but you
  must be running in the parent partition of the partition being modified.
  <span class="q">&#147;Modify&#148;</span> means to change a partition's percentage or critical budget.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_NONZERO_BUDGETS</span></dt>

<dd class="dd">A partition may not be created with, or modified to have, a zero budget.
  Unless you know that all your partitions need to run only in response to client requests, i.e.,
  receipt of messages, you should set this option.
  
  
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_ROOT_MAKES_CRITICAL</span></dt>

<dd class="dd">Your process must have the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled in
  order to create a nonzero critical budget or change an existing critical budget.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_SYS_MAKES_CRITICAL</span></dt>

<dd class="dd">You must be running in the System partition to create a nonzero critical budget or
  change an existing critical budget.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_ROOT_JOINS</span></dt>

<dd class="dd">Your process must have the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled in
  order to join a thread to a partition.
  
  
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_SYS_JOINS</span></dt>

<dd class="dd">You must be running in the System partition in order to join a thread.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_PARENT_JOINS</span></dt>

<dd class="dd">You must be running in the parent partition of the partition you wish to join to.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_JOIN_SELF_ONLY</span></dt>

<dd class="dd">The caller of the
  <a class="xref" href="#schedctl__SCHED_APS_JOIN_PARTITION"><span class="keyword const">SCHED_APS_JOIN_PARTITION</span></a>
  command must specify 0 for the <var class="keyword varname">pid</var> and <var class="keyword varname">tid</var>.
  In other words, a process may join only itself to a partition.
  
</dd>




<dt class="dt dlterm"><span class="keyword const">SCHED_APS_SEC_PARTITIONS_LOCKED</span></dt>

<dd class="dd">Prevent further changes to any partition's budget, or overall scheduling parameters, such as the window size.
  Set this after you've set up your partitions.
  Once you've locked the partitions, you can still use the
  <a class="xref" href="#schedctl__SCHED_APS_JOIN_PARTITION"><span class="keyword const">SCHED_APS_JOIN_PARTITION</span></a>
  command.
  
</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_ADD_SECURITY</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EACCES</span></dt>

<dd class="dd">The calling thread doesn't meet the security options set (see
  <a class="xref" href="#schedctl__SCHED_APS_ADD_SECURITY"><span class="keyword const">SCHED_APS_ADD_SECURITY</span></a>).
  Your process must have the <span class="keyword const">PROCMGR_AID_APS_ROOT</span> ability enabled.
</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>



</dl>



<p class="p" id="schedctl__SCHED_APS_QUERY_PROCESS"><strong class="ph b"><span class="keyword const">SCHED_APS_QUERY_PROCESS</span></strong></p>

<p class="p">




This command returns the partition of the given process.
The partition of a process is billed while one of the process's threads handles a pulse.
The individual threads in a process may all be in different partitions from the process.
</p>


<p class="p">

The <var class="keyword varname">data</var> argument for this command must be a pointer to a
<span class="keyword dtype">sched_aps_query_process_parms</span> structure:
</p>


<pre class="pre codeblock">
typedef struct { 
        int32_t     pid;
        /* out parms: */
        int16_t     id;     /* partition of process */
        int16_t     reserved1;
        int64_t     reserved2;
        int64_t     reserved3;
        int32_t     reserved4;
} sched_aps_query_process_parms;
</pre>


<p class="p">
The members include:
</p>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">pid</var></dt>

<dd class="dd">The process ID, or 0 for the calling process.</dd>




<dt class="dt dlterm"><var class="keyword varname">id</var></dt>

<dd class="dd">The ID of the process's partition.</dd>



</dl>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_APS_QUERY_PROCESS</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EDOM</span></dt>

<dd class="dd">A reserved field isn't zero.
  You might not have used <span class="keyword apiname">APS_INIT_DATA()</span> to initialize the data parameter.
</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure.</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">The adaptive partitioning scheduler isn't installed.</dd>




<dt class="dt dlterm"><span class="keyword const">ESRCH</span></dt>

<dd class="dd">The process wasn't found.</dd>



</dl>





<p class="p" id="schedctl__SCHED_CONFIGURE"><strong class="ph b"><span class="keyword const">SCHED_CONFIGURE</span> (QNX Neutrino 7.0.1 or later)</strong></p>


<p class="p">

As a trade-off between latency and throughput, the scheduling algorithm makes decisions that people
who expect strict priority scheduling occasionally find surprising:
</p>


<ul class="ul">
<li class="li">A high-priority thread <var class="keyword varname">T</var> that becomes ready on CPU <var class="keyword varname">A</var>
  doesn't always displace a lower-priority thread running on that CPU.
  Under some circumstances, an interprocessor interruptor (IPI) is sent to CPU <var class="keyword varname">B</var>
  to force it to perform a new scheduling decision, which is expected (but not guaranteed)
  to cause thread <var class="keyword varname">T</var> to run on CPU <var class="keyword varname">B</var>.

  <p class="p">
  Immediately scheduling the higher-priority thread to run on CPU A results in lower thread latency
  for the high-priority thread, but at the expense of decreased total throughput,
  as it incurs the cost of interrupting the lower-priority thread and possibly moving it to another CPU.
  </p>

</li>


<li class="li">If a thread <var class="keyword varname">T</var> that's running on CPU <var class="keyword varname">A</var> is displaced by a
  higher-priority thread, and a thread with a priority lower than <var class="keyword varname">T</var>'s is running on
  CPU <var class="keyword varname">B</var>, CPU <var class="keyword varname">B</var> might not be signalled to reevaluate its scheduling decision.
  High-priority threads normally perform small amounts of work and then voluntarily suspend themselves.
  In that case, migrating thread T is likely unnecessary and would reduce the total system throughput.
</li>


</ul>


<p class="p">

The end result is that only the highest-priority thread in the system is guaranteed to run on some CPU,
while the other CPUs may be running threads with lower priorities than those ready to run at any given point in time.
The <span class="keyword const">SCHED_CONFIGURE</span> command provides some parameters that you can use to tune the scheduler.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
In order to use this command,
your process must have the <span class="keyword const">PROCMGR_AID_SCHEDULE</span> ability enabled; see
<a class="xref" href="../p/procmgr_ability.html" title="Control a process's ability to perform certain operations"><span class="keyword apiname">procmgr_ability()</span></a>.
</div>


<p class="p">
The <var class="keyword varname">data</var> argument for this command must be a pointer to a
<span class="keyword dtype">struct sched_config</span>.
This structure includes the following members:
</p>


<dl class="dl">

<dt class="dt dlterm"><span class="keyword dtype">int32_t</span> <var class="keyword varname">low_latency_priority</var></dt>

<dd class="dd">The priority threshold above which a thread always displaces a lower-priority thread running on the CPU
  on which it becomes ready.
  Effectively, this parameter lets you define a priority class as <span class="q">&#147;low latency,&#148;</span>
  avoiding the overhead of an IPI and a new scheduling decision by another CPU.
</dd>




<dt class="dt dlterm"><span class="keyword dtype">int32_t</span> <var class="keyword varname">migrate_priority</var></dt>

<dd class="dd">The priority threshold above which a preempted thread will be rescheduled on another CPU (the one
  running the lowest-priority thread).
</dd>



</dl>


<p class="p">
Keeping both parameters at their default values (<span class="keyword const">INT_MAX</span>) maintains the scheduling behavior
described above.
</p>


<p class="p">
For example, suppose there are three threads, T20, T10, and T5, where the priority of each thread matches
the thread's label, and that
T10 is running on CPU A, and T5 is running on CPU B.
If thread T20 becomes ready on CPU A, then the results are as follows:
</p>


<ul class="ul">
<li class="li">If <var class="keyword varname">low_latency_priority</var> &gt; 20, T20 migrates to CPU B and displaces T5,
  leaving T10 and T20 running, but the thread latency of T20 was impacted by the necessity of sending an
  IPI to CPU B to perform the rescheduling there.
</li>


<li class="li">If <var class="keyword varname">low_latency_priority</var> &lt;= 20, T20 preempts T10 immediately and thus minimizes
  its thread latency, but at the expense of migrating T10 to another CPU.
</li>


<li class="li">If T10 is preempted, then:

  <ul class="ul">
  <li class="li">If <var class="keyword varname">migrate_priority</var> &gt; 10, T10 doesn't migrate and doesn't run,
    leaving T5 running while T10 is ready.
  </li>


  <li class="li">If <var class="keyword varname">migrate_priority</var> &lt;= 10, T10 migrates to CPU B and displaces T5.</li>


  </ul>

</li>


</ul>


<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_CONFIGURE</span> command (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The size of the parameter block doesn't match the size of the expected structure.</dd>




<dt class="dt dlterm"><span class="keyword const">EPERM</span></dt>

<dd class="dd">You don't have the <span class="keyword const">PROCMGR_AID_SCHEDULE</span> ability enabled.</dd>



</dl>



<p class="p" id="schedctl__SCHED_CONT_APP"><strong class="ph b"><span class="keyword const">SCHED_CONT_APP</span> and <span class="keyword const">SCHED_STOP_APP</span> (QNX Neutrino 7.0 or later)</strong></p>


<p class="p">


The <span class="keyword const">SCHED_STOP_APP</span> and <span class="keyword const">SCHED_CONT_APP</span> commands make all processes with the given
application ID stop or continue.
<span class="q">&#147;Stop&#148;</span> means that no thread in any of these processes is scheduled,
and <span class="q">&#147;continue&#148;</span> means allowing these threads to be scheduled again, subject to their current state.
  You use these commands like this (for more information, see 
  <a class="xref" href="../../../com.qnx.doc.security.system/topic/manual/application_groups.html">"Application groups"</a> in the <cite class="cite">QNX Neutrino System Security Guide</cite>):
</p>


<pre class="pre codeblock">
if ( SchedCtl( SCHED_STOP_APP, (void *)appid, 0) == -1 ) {
   /* An error occurred */
}

...

if ( SchedCtl( SCHED_CONT_APP, (void *)appid, 0) == -1 ) {
   /* An error occurred */
}
</pre>


<p class="p">
This mechanism is independent of the <span class="keyword const">SIGSTOP</span> and <span class="keyword const">SIGCONT</span> signals;
for example, a <span class="keyword const">SIGCONT</span> doesn't resume a thread that belongs to a process that was stopped by a
<samp class="ph codeph">SchedCtl(SCHED_STOP_APP, ...)</samp> call.
Nevertheless, in order to successfully issue these commands, your process must have the
<span class="keyword const">PROCMGR_AID_SIGNAL</span> ability enabled such that you <em class="ph i">could</em> send the appropriate signal:
</p>


<ul class="ul">
<li class="li"><span class="keyword const">SIGCONT</span> for <span class="keyword const">SCHED_CONT_APP</span></li>

<li class="li"><span class="keyword const">SIGSTOP</span> for <span class="keyword const">SCHED_STOP_APP</span></li>

</ul>


<p class="p">
For more information about <span class="keyword const">PROCMGR_AID_SIGNAL</span>, see
<a class="xref" href="../p/procmgr_ability.html" title="Control a process's ability to perform certain operations"><span class="keyword apiname">procmgr_ability()</span></a>.
</p>


<p class="p">
This mechanism interacts with the <span class="keyword const">_NTO_TCTL_ONE_THREAD_CONT</span> and
<span class="keyword const">_NTO_TCTL_ONE_THREAD_HOLD</span> commands for
<a class="xref" href="../t/threadctl.html" title="Control a thread"><span class="keyword apiname">ThreadCtl()</span></a>
as follows:
</p>


<ul class="ul">
<li class="li"><span class="keyword const">SCHED_STOP_APP</span> stops  threads in the specified application
  that are running.
</li>


<li class="li"><span class="keyword const">SCHED_CONT_APP</span> starts  threads in the specified application
  that were stopped by <span class="keyword const">SCHED_STOP_APP</span>, but not those that were stopped by
  <span class="keyword const">_NTO_TCTL_ONE_THREAD_HOLD</span>.
</li>


<li class="li"><span class="keyword const">_NTO_TCTL_ONE_THREAD_CONT</span> starts  threads that were stopped by
  <span class="keyword const">_NTO_TCTL_ONE_THREAD_HOLD</span> or <span class="keyword const">SCHED_STOP_APP</span>.
</li>


</ul>



<p class="p"><strong class="ph b">Errors:</strong></p>


<p class="p">
<span class="keyword apiname">SchedCtl()</span> and <span class="keyword apiname">SchedCtl_r()</span> indicate the following
errors for the <span class="keyword const">SCHED_CONT_APP</span> and <span class="keyword const">SCHED_STOP_APP</span> commands (see the
<a class="xref" href="#schedctl__Returns">Returns</a> section for details):
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EOK</span></dt>

<dd class="dd">Success; at least one app was made to continue or stop, depending on the command.</dd>




<dt class="dt dlterm"><span class="keyword const">EPERM</span></dt>

<dd class="dd">You don't have the <span class="keyword const">PROCMGR_AID_SIGNAL</span> ability enabled for the appropriate signal.</dd>




<dt class="dt dlterm"><span class="keyword const">ESRCH</span></dt>

  <dd class="dd">No process with the given application ID was found, or the application ID is the one for the process manager. For 
    more information, see <a class="xref" href="../../../com.qnx.doc.security.system/topic/manual/application_groups.html">"Application groups"</a> in the <cite class="cite">QNX Neutrino System Security Guide</cite>.</dd>



</dl>



<p class="p"><strong class="ph b">Blocking states</strong></p>




<p class="p">
These calls don't block.
</p>

</div>


<div class="section" id="schedctl__Returns"><h2 class="title sectiontitle">Returns:</h2>


<p class="p">
The only difference between these functions is the way they indicate errors:
</p>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword apiname">SchedCtl()</span></dt>

<dd class="dd">0 if the call succeeds. If an error occurs, <span class="keyword apiname">SchedCtl()</span> returns -1 and sets
              <a class="xref" href="../e/errno.html" title="Thread-local error variable"><var class="keyword varname">errno</var></a>. </dd>




<dt class="dt dlterm"><span class="keyword apiname">SchedCtl_r()</span></dt>

<dd class="dd"><span class="keyword const">EOK</span> is returned on success. This function does NOT set <var class="keyword varname">errno</var>.
            If an error occurs, any of the error codes listed in the command descriptions above may
            be returned. </dd>



</dl>


</div>


<div class="section"><h2 class="title sectiontitle">Examples:</h2>


<pre class="pre codeblock">
sched_aps_partition_info part_info; 

// You need to initialize the parameter block.
APS_INIT_DATA(&amp;part_info); 

// Set the input members of the parameter block.
part_info.id = 2;

// Invoke SchedCtl to query the partition. 
ret = SchedCtl( SCHED_APS_QUERY_PARTITION, &amp;part_info,
      sizeof(part_info) );
if (EOK!=ret) some_kind_of_error_handler(); 

// Use output field 
printf( "The budget is %d per cent.\n",
        part_info.budget_percent); 
</pre>

</div>


<div class="section"><h2 class="title sectiontitle">Classification:</h2>


<p class="p">
<a class="xref" href="../summary.html#summary__CLASSIFICATION">QNX Neutrino</a>
</p>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
  <tr>
    <th class="entry" valign="top" id="d2559079e4282">Safety:</th>

    <th class="entry" valign="top" id="d2559079e4285">Â </th>

  </tr>

</thead>


<tbody class="tbody">
  <tr>
    <td class="entry" valign="top" headers="d2559079e4282 d2559079e4285 ">Cancellation point</td>

    <td class="entry" valign="top" headers="d2559079e4282 d2559079e4285 ">No</td>

  </tr>

  <tr>
    <td class="entry" valign="top" headers="d2559079e4282 d2559079e4285 ">Interrupt handler</td>

    <td class="entry" valign="top" headers="d2559079e4282 d2559079e4285 ">No</td>

  </tr>

  <tr>
    <td class="entry" valign="top" headers="d2559079e4282 d2559079e4285 ">Signal handler</td>

    <td class="entry" valign="top" headers="d2559079e4282 d2559079e4285 ">Yes</td>

  </tr>

  <tr>
    <td class="entry" valign="top" headers="d2559079e4282 d2559079e4285 ">Thread</td>

    <td class="entry" valign="top" headers="d2559079e4282 d2559079e4285 ">Yes</td>

  </tr>


</tbody>

</table>
</div>


</div>


</div>


<div class="related-links"><div class="relinfo relconcepts"><strong>Related concepts</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.adaptivepartitioning.userguide/topic/about_howtouseguide_.html" title="Adaptive Partitioning User's Guide">Adaptive Partitioning User's Guide</a></div>
</div>
<div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/s/schedget.html" title="Get the scheduling policy and parameters for a thread">SchedGet(), SchedGet_r()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/s/schedinfo.html" title="Get scheduler information">SchedInfo(), SchedInfo_r()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/s/schedset.html" title="Set the scheduling policy and parameters for a thread">SchedSet(), SchedSet_r()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/s/schedyield.html" title="Yield to other threads">SchedYield(), SchedYield_r()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/s/sigevent.html" title="Structure that describes an event">sigevent</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.utilities/topic/a/aps.html" title="aps (Utilities Reference)">aps (Utilities Reference)</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-s.html" title="S"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">S</span></a></span>  </div>
</body>
</html>