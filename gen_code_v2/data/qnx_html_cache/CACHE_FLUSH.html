
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="CACHE_FLUSH()" /><meta name="abstract" content="Flush cache lines associated with a data buffer" /><meta name="description" content="Flush cache lines associated with a data buffer" /><meta name="indexterms" content="CACHE_FLUSH()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-c.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/c/cache_fini.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/c/cache_init.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/c/cache_inval.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="cache_flush" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>CACHE_FLUSH()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="cache_flush">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-c.html" title="C">C</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-c.html" title="C"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">C</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">CACHE_FLUSH()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>


<div class="body refbody"><p class="shortdesc"><em class="ph i">Flush cache lines associated with  a data buffer</em></p>


<div class="section">

<p class="p">


</p>

</div>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>

<pre class="pre codeblock">
#include &lt;sys/cache.h&gt;

CACHE_FLUSH(struct cache_ctrl *<var class="keyword varname">cinfo</var>, 
            void *<var class="keyword varname">vaddr</var>, 
            uint64_t <var class="keyword varname">paddr</var>, 
            size_t <var class="keyword varname">len</var>);
</pre>

</div>



<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">cinfo</var></dt>

<dd class="dd">A pointer to the structure that was initially passed to <span class="keyword apiname">cache_init()</span>.</dd>




<dt class="dt dlterm"><var class="keyword varname">vaddr</var></dt>

<dd class="dd">The virtual address of the buffer; this is a pointer to the data in the driver's virtual address space.</dd>




<dt class="dt dlterm"><var class="keyword varname">paddr</var></dt>

<dd class="dd">The physical address of the buffer: this is typically in the same address space that the external
  device will use to reference the data.
  The physical address is obtained by calling <span class="keyword apiname">mem_offset64()</span>.
  Since this function is fairly costly, drivers typically allocate a pool
  of data buffers at initialization (e.g., by calling <span class="keyword apiname">mmap()</span>
  with the <samp class="ph codeph">MAP_SHARED | MAP_PHYS | MAP_ANON</samp> flags), and predetermine
  the physical addresses of the data.
</dd>




<dt class="dt dlterm"><var class="keyword varname">len</var></dt>

<dd class="dd">The number of bytes in the buffer, for which cached data should be flushed to memory.</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Library:</h2>


<p class="p"><span class="ph filepath">libcache</span></p>


<p class="p">
Use the <span class="keyword option">-l cache</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library.
</p>

</div>



<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p">
This macro is used to flush any cache lines associated with
a data buffer out to memory.  This routine ensures that
any modifications that have been made to the data by the CPU
will be reflected by the contents of memory, and thus
an external device reading the data won't retrieve
stale data. For more information about cache coherency, see the entry for
<a class="xref" href="cache_init.html" title="Register with the cache-coherency library"><span class="keyword apiname">cache_init()</span></a>.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
This macro was added in QNX Momentics 6.3.0 SP2.
</div>


<p class="p">
Depending on the architecture and the cache callouts (see
<span class="q">&#147;<a class="xref" href="../../../com.qnx.doc.neutrino.building/topic/callouts/callout_cache.html">Cache control</a>&#148;</span>
in the <span class="q">&#147;Kernel Callouts&#148;</span> chapter of <cite class="cite">Building Embedded Systems</cite>),
the calling thread might need to obtain I/O privileges before using the <span class="keyword apiname">CACHE_*()</span> macros.
If so, then:
</p>


<ul class="ul">
<li class="li">The process must have the <span class="keyword const">PROCMGR_AID_IO</span> ability enabled.
  For more information, see
  <a class="xref" href="../p/procmgr_ability.html" title="Control a process's ability to perform certain operations"><span class="keyword apiname">procmgr_ability()</span></a>.
  
</li>


<li class="li">The thread must call
  <a class="xref" href="../t/threadctl.html" title="Control a thread"><span class="keyword apiname">ThreadCtl()</span></a> as follows:
<pre class="pre codeblock">
ThreadCtl( _NTO_TCTL_IO_LEVEL, (void*)_NTO_IO_LEVEL_1 );
</pre>

  
  
  
  
  
  
</li>


</ul>


<p class="p">

Failing to do so may result in a <span class="keyword const">SIGILL</span> (illegal instruction)
signal.
</p>

</div>



<div class="section"><h2 class="title sectiontitle">Environment variables:</h2>


<p class="p">
The following environment variables, if they exist, affect the behavior of this function:
</p>


<dl class="dl">


<dt class="dt dlterm"><span class="keyword envar">CACHE_NOP</span></dt>

<dd class="dd">Instructs the library that the
  <a class="xref" href="cache_flush.html" title="Flush cache lines associated with a data buffer"><span class="keyword apiname">CACHE_FLUSH()</span></a>  
  and
  <a class="xref" href="cache_inval.html" title="Invalidate cache lines associated with a data buffer"><span class="keyword apiname">CACHE_INVAL()</span></a>
  macros should have no effect.
  
  
</dd>




<dt class="dt dlterm"><span class="keyword envar">CACHE_MSYNC</span></dt>

<dd class="dd">Instructs the library that the 
  <a class="xref" href="cache_flush.html" title="Flush cache lines associated with a data buffer"><span class="keyword apiname">CACHE_FLUSH()</span></a> 
  and
  <a class="xref" href="cache_inval.html" title="Invalidate cache lines associated with a data buffer"><span class="keyword apiname">CACHE_INVAL()</span></a>
  macros should use the
  <a class="xref" href="../m/msync.html" title="Synchronize memory with physical storage"><span class="keyword apiname">msync()</span></a>
  C library call to perform cache synchronization.
  
  
</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Classification:</h2>

<p class="p"><a class="xref" href="../summary.html#summary__CLASSIFICATION">QNX Neutrino</a></p>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr><th class="entry" valign="top" id="d1263569e375">Safety:</th>
<th class="entry" valign="top" id="d1263569e377">Â </th>
</tr>

</thead>

<tbody class="tbody">
<tr><td class="entry" valign="top" headers="d1263569e375 d1263569e377 ">Cancellation point</td>
<td class="entry" valign="top" headers="d1263569e375 d1263569e377 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d1263569e375 d1263569e377 ">Interrupt handler</td>
<td class="entry" valign="top" headers="d1263569e375 d1263569e377 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d1263569e375 d1263569e377 ">Signal handler</td>
<td class="entry" valign="top" headers="d1263569e375 d1263569e377 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d1263569e375 d1263569e377 ">Thread</td>
<td class="entry" valign="top" headers="d1263569e375 d1263569e377 ">Yes</td>
</tr>

</tbody>

</table>
</div>

</div>



<div class="section"><h2 class="title sectiontitle">Caveats:</h2>


<p class="p">
<span class="keyword apiname">CACHE_FLUSH()</span> is implemented as a macro.
</p>

</div>


</div>


<div class="related-links"><div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/c/cache_fini.html" title="Free cache-coherency resources when the driver is unloaded">cache_fini()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/c/cache_init.html" title="Register with the cache-coherency library">cache_init()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/c/cache_inval.html" title="Invalidate cache lines associated with a data buffer">CACHE_INVAL()</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-c.html" title="C"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">C</span></a></span>  </div>
</body>
</html>