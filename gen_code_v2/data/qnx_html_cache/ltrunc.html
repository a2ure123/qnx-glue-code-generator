
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
      <meta name="copyright" content="(C) Copyright 2005" /><meta name="DC.rights.owner" content="(C) Copyright 2005" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="ltrunc()" /><meta name="abstract" content="Truncate a file at a given position" /><meta name="description" content="Truncate a file at a given position" /><meta name="indexterms" content="ltrunc()" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-l.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/e/errno.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/f/ftruncate.html" /><meta name="DC.Relation" scheme="URI" content="../../../com.qnx.doc.neutrino.lib_ref/topic/l/lseek.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="ltrunc" /><meta name="DC.Language" content="en-us" /><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>ltrunc()</title><link rel="canonical" type="html" href="https://www.qnx.com/developers/docs/7.1/#com.qnx.doc.neutrino.lib_ref/" /><!--  Generated with Oxygen version 18.1, build number 2017020917.  --><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css" /><script type="text/javascript"><!--
            
            var prefix = "../../../index.html";
            
            --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.11.3.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script><script type="text/javascript"> var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-27400275-1']); _gaq.push(['_setDomainName', 'www.qnx.com']);_gaq.push(['_setAllowLinker', true]);_gaq.push(['_trackPageview']);(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="ltrunc">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td style="width:75%;"><span class="topic_breadcrumb_links"><span class="topic_breadcrumb_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-l.html" title="L">L</a></span></span></td><td><span id="topic_navigation_links" class="navheader">
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-l.html" title="L"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">L</span></a></span>  </span></td></tr></tbody></table>


<h1 class="title topictitle1"><span class="keyword apiname">ltrunc()</span></h1>
<table width="100%"><tbody><tr><td align="left"><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">QNX SDP</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">7.1</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">C Library Reference</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">API</button><button style="margin:3px 5px; background-color:default; border:default; pointer-events: none; font-size:0.9em;">Developer</button></td><td align="right"><span style="margin:0px 5px; font-size:0.9em;">Updated: October 28, 2024</span></td></tr></tbody></table>


<div class="body refbody"><p class="shortdesc"><em class="ph i">Truncate a file at a given position</em></p>


<div class="section refsyn"><h2 class="title sectiontitle">Synopsis:</h2>

<pre class="pre codeblock">
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

off_t ltrunc( int <var class="keyword varname">filedes</var>, 
              off_t <var class="keyword varname">offset</var>,
              int <var class="keyword varname">whence</var> );
</pre>

</div>



<div class="section"><h2 class="title sectiontitle">Arguments:</h2>


<dl class="dl">

<dt class="dt dlterm"><var class="keyword varname">filedes</var></dt>

<dd class="dd">The file descriptor of the file that you want to truncate.</dd>




<dt class="dt dlterm"><var class="keyword varname">offset</var></dt>

<dd class="dd">The relative offset from the file position determined by the
  <var class="keyword varname">whence</var> argument.
</dd>




<dt class="dt dlterm"><var class="keyword varname">whence</var></dt>

<dd class="dd">The position in the file.
  The possible values (defined in <span class="ph filepath">&lt;unistd.h&gt;</span>) are:

  <dl class="dl">
  
  <dt class="dt dlterm"><span class="keyword const">SEEK_CUR</span></dt>

  <dd class="dd">The new file position is computed relative to the current file
    position. The value of <var class="keyword varname">offset</var> may be positive, negative or zero.
    
  </dd>

  

  
  <dt class="dt dlterm"><span class="keyword const">SEEK_END</span></dt>

  <dd class="dd">The new file position is computed relative to the end of the file.
    
  </dd>

  

  
  <dt class="dt dlterm"><span class="keyword const">SEEK_SET</span></dt>

  <dd class="dd">The new file position is computed relative to the start of the file.
     The value of <var class="keyword varname">offset</var> must not be negative.
     
  </dd>

  

  </dl>

</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Library:</h2>


<p class="p"><span class="ph filepath">libc</span></p>


<p class="p">
Use the <span class="keyword option">-l c</span> option to
<a class="xref" href="../../../com.qnx.doc.neutrino.utilities/topic/q/qcc.html"><span class="keyword cmdname">qcc</span></a>
to link against this library.
This library is usually included automatically.
</p>

</div>



<div class="section"><h2 class="title sectiontitle">Description:</h2>


<p class="p">




The <span class="keyword apiname">ltrunc()</span> function attempts to truncate the file at a
specified position. The file, referenced by the open file descriptor
<var class="keyword varname">filedes</var>, must have been opened <span class="keyword const">O_WRONLY</span> or
<span class="keyword const">O_RDWR</span>. The truncation point is calculated using the value
of <var class="keyword varname">offset</var> as a relative offset from a file position
determined by the value of the argument <var class="keyword varname">whence</var>. The value of
<var class="keyword varname">offset</var> may be negative, although a negative truncation point
(one before the beginning of the file) is an error.
</p>


<div class="note note"><span class="notetitle">Note:</span> 
The <span class="keyword apiname">ltrunc()</span> function ignores advisory locks that may have been set by
<a class="xref" href="../f/fcntl.html" title="Provide control over an open file"><span class="keyword apiname">fcntl()</span></a>.
</div>


<p class="p">
The calculated truncation point, if within the existing bounds of the
file, determines the new file size; all data after the truncation
point no longer exists. If the truncation point is past the existing
end of file, the file size isn't changed. An error occurs if you
attempt to truncate before the beginning of the file (that is, a negative
truncation point).
</p>


<div class="note note"><span class="notetitle">Note:</span> 
The current seek position isn't changed by this function under any
circumstance, including the case where the current seek position is
beyond the truncation point.
</div>


</div>



<div class="section"><h2 class="title sectiontitle">Returns:</h2>


<p class="p">
Upon successful completion, this function returns the new file size.
If a truncation point beyond the existing end of file was specified,
the existing file size is returned, and the file size remains
unchanged. Otherwise, <span class="keyword apiname">ltrunc()</span> returns a value of -1 and sets
<a class="xref" href="../e/errno.html" title="Thread-local error variable"><var class="keyword varname">errno</var></a>
to indicate the error. The file size remains unchanged
in the event of an error.
</p>

</div>



<div class="section"><h2 class="title sectiontitle">Errors:</h2>


<dl class="dl" compact="compact">

<dt class="dt dlterm"><span class="keyword const">EBADF</span></dt>

<dd class="dd">The <var class="keyword varname">filedes</var> argument isn't a valid file descriptor, open for writing.</dd>




<dt class="dt dlterm"><span class="keyword const">EINVAL</span></dt>

<dd class="dd">The <var class="keyword varname">whence</var> argument isn't a proper value, or the resulting
  file size would be invalid.
</dd>




<dt class="dt dlterm"><span class="keyword const">ENOSYS</span></dt>

<dd class="dd">An attempt was made to truncate a file of a type that doesn't
  support truncation (for example, a file associated with the device manager).
</dd>




<dt class="dt dlterm"><span class="keyword const">ESPIPE</span></dt>

<dd class="dd">The <var class="keyword varname">filedes</var> argument is associated with a pipe, FIFO, or socket.</dd>



</dl>


</div>



<div class="section"><h2 class="title sectiontitle">Examples:</h2>


<pre class="pre codeblock">
#include &lt;stdio.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

char buffer[1000];

int main( void )
{
    int fd, stat;

    fd = open( "test", O_CREAT | O_RDWR, 0666 );
    if( fd == -1 ) {
        fprintf( stderr, "Open error\n" );
        exit( -1 );
    }

    /* Create a 1000-byte file */
    write( fd, buffer, 1000 );

    /* Seek back to offset 500 and truncate the file */
    if( ltrunc( fd, 500, SEEK_SET ) == -1 ) {
        fprintf( stderr, "ltrunc error\n" );
        exit( -1 );
    }
    close( fd );
    fd = open( "test", O_CREAT | O_RDWR, 0666 );
    printf( "File size = %ld\n",
        lseek( fd, 0, SEEK_END ) );
    close( fd );

    return 0;
}
</pre>


</div>



<div class="section"><h2 class="title sectiontitle">Classification:</h2>

<p class="p"><a class="xref" href="../summary.html#summary__CLASSIFICATION">QNX Neutrino</a></p>



<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
<thead class="thead" align="left">
<tr><th class="entry" valign="top" id="d2131675e323">Safety:</th>
<th class="entry" valign="top" id="d2131675e325">Â </th>
</tr>

</thead>

<tbody class="tbody">
<tr><td class="entry" valign="top" headers="d2131675e323 d2131675e325 ">Cancellation point</td>
<td class="entry" valign="top" headers="d2131675e323 d2131675e325 ">Yes</td>
</tr>

<tr><td class="entry" valign="top" headers="d2131675e323 d2131675e325 ">Interrupt handler</td>
<td class="entry" valign="top" headers="d2131675e323 d2131675e325 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d2131675e323 d2131675e325 ">Signal handler</td>
<td class="entry" valign="top" headers="d2131675e323 d2131675e325 ">No</td>
</tr>

<tr><td class="entry" valign="top" headers="d2131675e323 d2131675e325 ">Thread</td>
<td class="entry" valign="top" headers="d2131675e323 d2131675e325 ">Yes</td>
</tr>

</tbody>

</table>
</div>

</div>



<div class="section"><h2 class="title sectiontitle">Caveats:</h2>


<p class="p">
The <span class="keyword apiname">ltrunc()</span> function <em class="ph i">isn't portable</em>, and shouldn't
be used in new code.
Use <a class="xref" href="../f/ftruncate.html" title="Truncate a file"><span class="keyword apiname">ftruncate()</span></a>
instead.
</p>

</div>


</div>





<div class="related-links"><div class="relinfo relref"><strong>Related reference</strong><br />
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/e/errno.html" title="Thread-local error variable">errno</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/f/ftruncate.html" title="Truncate a file">ftruncate(), ftruncate64()</a></div>
<div class="related_link"><a class="navheader_parent_path" href="../../../com.qnx.doc.neutrino.lib_ref/topic/l/lseek.html" title="Set the current read/write file offset">lseek(), lseek64()</a></div>
</div>
</div><div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../../../com.qnx.doc.neutrino.lib_ref/topic/lib-l.html" title="L"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">L</span></a></span>  </div>
</body>
</html>